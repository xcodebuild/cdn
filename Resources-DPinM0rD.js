import{bg as N,ba as v,bb as b,b7 as k,bD as D,u as T,r as h,l as R,aA as w,j as e,I as p,bo as S,L as M,T as I,s as L}from"./index-DRKdyhzb.js";import{s as C}from"./CommonDialog-aMGtbYQ-.js";import{E}from"./Empty-BkwmF9Ca.js";import{M as F}from"./MobileHeader-DhNMB_G6.js";import{t as A,R as g}from"./ResourceIcon-CVNzAEyj.js";import{u as _,I as z}from"./useLoading-Dble4Yjd.js";import{v as B}from"./values-DHFoHTxW.js";import{D as O}from"./Divider-ByJybYhk.js";import"./last-DXTTfs9a.js";var Q="[object String]";function U(t){return typeof t=="string"||!N(t)&&v(t)&&b(t)==Q}var P=Math.max;function W(t,l,a,i){t=k(t)?t:B(t),a=a&&!i?A(a):0;var r=t.length;return a<0&&(a=P(r+a,0)),U(t)?a<=r&&t.indexOf(l,a)>-1:!!r&&D(t,l,a)>-1}function Y(t){const l=t.slice();l.sort((i,r)=>{const n=new Date(i.createTime);return new Date(r.createTime).getTime()-n.getTime()});const a=new Map;return l.forEach(i=>{var x;const r=new Date(i.createTime),n=r.getFullYear(),o=r.getMonth()+1,c=Date.UTC(n,o-1,1);a.has(c)||a.set(c,[]),(x=a.get(c))==null||x.push(i)}),a}const ee=()=>{const t=T(),l=_(),[a,i]=h.useState({searchQuery:""}),r=R(),[n,o]=h.useState([]),c=n.filter(s=>W(s.filename,a.searchQuery)),x=Y(c.filter(s=>s.memoId)),d=c.filter(s=>!s.memoId);h.useEffect(()=>{w.listResources({}).then(({resources:s})=>{o(s),l.setFinish(),Promise.all(s.map(u=>u.memoId?r.getOrFetchMemoById(u.memoId):null))})},[]);const y=()=>{C({title:"Delete all unused resources",content:"Are you sure to delete all unused resources? This action cannot be undone.",style:"warning",dialogName:"delete-unused-resources-dialog",onConfirm:async()=>{for(const s of d)await w.deleteResource({id:s.id});o(n.filter(s=>s.memoId))}})};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[e.jsx(F,{}),e.jsx("div",{className:"w-full px-4 sm:px-6",children:e.jsxs("div",{className:"w-full shadow flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-black dark:text-gray-300",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsxs("p",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",children:[e.jsx(p.Paperclip,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:t("common.resources")})]}),e.jsx("div",{children:e.jsx(z,{className:"max-w-[8rem]",placeholder:t("common.search"),startDecorator:e.jsx(p.Search,{className:"w-4 h-auto"}),value:a.searchQuery,onChange:s=>i({...a,searchQuery:s.target.value})})})]}),e.jsx("div",{className:"w-full flex flex-col justify-start items-start mt-4 mb-6",children:l.isLoading?e.jsx("div",{className:"w-full h-32 flex flex-col justify-center items-center",children:e.jsx("p",{className:"w-full text-center text-base my-6 mt-8",children:t("resource.fetching-data")})}):e.jsx(e.Fragment,{children:c.length===0?e.jsxs("div",{className:"w-full mt-8 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(E,{}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-400",children:t("message.no-data")})]}):e.jsxs("div",{className:"w-full h-auto px-2 flex flex-col justify-start items-start gap-y-8",children:[Array.from(x.entries()).map(([s,u])=>{const j=new Date(s);return e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsxs("div",{className:"w-16 sm:w-24 pt-4 sm:pl-4 flex flex-col justify-start items-start",children:[e.jsx("span",{className:"text-sm opacity-60",children:j.getFullYear()}),e.jsx("span",{className:"font-medium text-xl",children:j.toLocaleString(S.language,{month:"short"})})]}),e.jsx("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:u.map(m=>{const f=m.memoId?r.getMemoById(m.memoId):null;return e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border dark:border-zinc-900 overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(g,{resource:m,strokeWidth:.5})}),e.jsxs("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:[e.jsx("p",{className:"text-xs shrink text-gray-400 truncate",children:m.filename}),f&&e.jsxs(M,{className:"shrink-0 text-xs ml-1 text-gray-400 hover:underline hover:text-blue-600",to:`/m/${f.name}`,target:"_blank",children:["#",f.id]})]})]},m.id)})})]},s)}),d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsxs("div",{className:"w-full flex flex-row justify-start items-start",children:[e.jsx("div",{className:"w-16 sm:w-24 sm:pl-4 flex flex-col justify-start items-start"}),e.jsxs("div",{className:"w-full max-w-[calc(100%-4rem)] sm:max-w-[calc(100%-6rem)] flex flex-row justify-start items-start gap-4 flex-wrap",children:[e.jsxs("div",{className:"w-full flex flex-row justify-start items-center gap-2",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unused resources"}),e.jsxs("span",{className:"text-gray-500 dark:text-gray-500 opacity-80",children:["(",d.length,")"]}),e.jsx(I,{title:"Delete all",placement:"top",children:e.jsx(L,{size:"sm",onClick:y,children:e.jsx(p.Trash,{className:"w-4 h-auto opacity-60"})})})]}),d.map(s=>e.jsxs("div",{className:"w-24 sm:w-32 h-auto flex flex-col justify-start items-start",children:[e.jsx("div",{className:"w-24 h-24 flex justify-center items-center sm:w-32 sm:h-32 border dark:border-zinc-900 overflow-clip rounded-xl cursor-pointer hover:shadow hover:opacity-80",children:e.jsx(g,{resource:s,strokeWidth:.5})}),e.jsx("div",{className:"w-full max-w-full flex flex-row justify-between items-center mt-1 px-1",children:e.jsx("p",{className:"text-xs shrink text-gray-400 truncate",children:s.filename})})]},s.id))]})]})]})]})})})]})})]})};export{ee as default};

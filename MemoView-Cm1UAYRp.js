import{r as x,S as br,P as nr,am as Et,an as Fs,A as R,j as r,D as xt,E as vt,G as J,ad as Bs,J as bt,F as Ue,Z as Zr,K as re,X as zt,ag as es,N as xe,O as yt,ao as yr,ac as ts,y as rs,H as Vs,ae as Us,ap as Tr,aq as Hs,af as Ws,aa as Ks,ar as nt,ai as Gs,aj as Js,as as ss,at as qs,au as os,k as De,av as Te,aw as Dt,ax as Xs,ay as Er,az as Ys,u as He,b as Cr,aA as Dr,aB as Pr,aC as Qs,aD as Zs,l as We,n as Se,s as Ne,I as _,B as ke,o as je,_ as Ot,aE as eo,M as it,aF as Ft,aG as Bt,aH as Vt,aI as Be,aJ as to,T as Ze,p as Pe,aK as ro,aL as ns,d as Ut,V as Ee,aM as so,aN as oo,aO as no,w as at,U as as,aP as Or,R as ao,aQ as G,aR as is,L as At,a as io}from"./index-DRKdyhzb.js";import{c as Ar,_ as lo,a as ft,M as wr,b as ls,d as _r,g as ar}from"./index-2UGuc62r.js";import{L as co,a as Ht,b as uo,V as jr,c as Ir}from"./VisibilityIcon-ijzoLo4J.js";import{g as lt,D as po,U as gt,T as $r,s as ho}from"./CommonDialog-aMGtbYQ-.js";import{S as mo,a as fo,b as go,c as xo,F as vo,I as dr,u as zr}from"./useLoading-Dble4Yjd.js";import{c as cs}from"./index-BG_UZG-p.js";import{a as mt}from"./Typography-B6lazjNl.js";import{S as Sr,O as _t}from"./Select-2jlx2KYh.js";import{c as kr}from"./createSvgIcon-DiGfNeH6.js";import{C as bo}from"./Checkbox-BFDDHFvA.js";import{L as yo}from"./Link-bshFRLSU.js";import{R as Co,s as wo}from"./ResourceIcon-CVNzAEyj.js";import{D as us}from"./Divider-ByJybYhk.js";const jo=t=>{const e=x.useRef({});return x.useEffect(()=>{e.current=t}),e.current};function Fr(t){return typeof t.normalize<"u"?t.normalize("NFD").replace(/[\u0300-\u036f]/g,""):t}function Io(t={}){const{ignoreAccents:e=!0,ignoreCase:s=!0,limit:o,matchFrom:n="any",stringify:i,trim:l=!1}=t;return(c,{inputValue:a,getOptionLabel:u})=>{let d=l?a.trim():a;s&&(d=d.toLowerCase()),e&&(d=Fr(d));const f=d?c.filter(h=>{let y=(i||u)(h);return s&&(y=y.toLowerCase()),e&&(y=Fr(y)),n==="start"?y.indexOf(d)===0:y.indexOf(d)>-1}):c;return typeof o=="number"?f.slice(0,o):f}}function ir(t,e){for(let s=0;s<t.length;s+=1)if(e(t[s]))return s;return-1}const So=Io(),Br=5,ko=t=>{var e;return t.current!==null&&((e=t.current.parentElement)==null?void 0:e.contains(document.activeElement))};function No(t){const{unstable_isActiveElementInListbox:e=ko,unstable_classNamePrefix:s="Mui",autoComplete:o=!1,autoHighlight:n=!1,autoSelect:i=!1,blurOnSelect:l=!1,clearOnBlur:c=!t.freeSolo,clearOnEscape:a=!1,componentName:u="useAutocomplete",defaultValue:d=t.multiple?[]:null,disableClearable:f=!1,disableCloseOnSelect:h=!1,disabled:y,disabledItemsFocusable:w=!1,disableListWrap:S=!1,filterOptions:k=So,filterSelectedOptions:N=!1,freeSolo:v=!1,getOptionDisabled:g,getOptionKey:C,getOptionLabel:U=m=>{var p;return(p=m.label)!=null?p:m},groupBy:T,handleHomeEndKeys:j=!t.freeSolo,id:P,includeInputInList:F=!1,inputValue:ee,isOptionEqualToValue:te=(m,p)=>m===p,multiple:O=!1,onChange:he,onClose:q,onHighlightChange:le,onInputChange:K,onOpen:Ae,open:Re,openOnFocus:Ge=!1,options:Je,readOnly:Ce=!1,selectOnFocus:et=!t.freeSolo,value:qe}=t,ae=br(P);let oe=U;oe=m=>{const p=U(m);return typeof p!="string"?String(p):p};const b=x.useRef(!1),$=x.useRef(!0),A=x.useRef(null),X=x.useRef(null),[H,me]=x.useState(null),[ce,ut]=x.useState(-1),Ct=n?0:-1,B=x.useRef(Ct),[L,_e]=nr({controlled:qe,default:d,name:u}),[z,ve]=nr({controlled:ee,default:"",name:u,state:"inputValue"}),[Xe,dt]=x.useState(!1),tt=x.useCallback((m,p)=>{if(!(O?L.length<p.length:p!==null)&&!c)return;let M;if(O)M="";else if(p==null)M="";else{const V=oe(p);M=typeof V=="string"?V:""}z!==M&&(ve(M),K&&K(m,M,"reset"))},[oe,z,O,K,ve,c,L]),[$e,wt]=nr({controlled:Re,default:!1,name:u,state:"open"}),[Kt,jt]=x.useState(!0),Ye=!O&&L!=null&&z===oe(L),de=$e&&!Ce,W=de?k(Je.filter(m=>!(N&&(O?L:[L]).some(p=>p!==null&&te(m,p)))),{inputValue:Ye&&Kt?"":z,getOptionLabel:oe}):[],fe=jo({filteredOptions:W,value:L,inputValue:z});x.useEffect(()=>{const m=L!==fe.value;Xe&&!m||v&&!m||tt(null,L)},[L,tt,Xe,fe.value,v]);const pt=$e&&W.length>0&&!Ce,Me=Et(m=>{m===-1?A.current.focus():H.querySelector(`[data-tag-index="${m}"]`).focus()});x.useEffect(()=>{O&&ce>L.length-1&&(ut(-1),Me(-1))},[L,O,ce,Me]);function Gt(m,p){if(!X.current||m<0||m>=W.length)return-1;let I=m;for(;;){const M=X.current.querySelector(`[data-option-index="${I}"]`),V=w?!1:!M||M.disabled||M.getAttribute("aria-disabled")==="true";if(M&&M.hasAttribute("tabindex")&&!V)return I;if(p==="next"?I=(I+1)%W.length:I=(I-1+W.length)%W.length,I===m)return-1}}const Le=Et(({event:m,index:p,reason:I="auto"})=>{if(B.current=p,p===-1?A.current.removeAttribute("aria-activedescendant"):A.current.setAttribute("aria-activedescendant",`${ae}-option-${p}`),le&&le(m,p===-1?null:W[p],I),!X.current)return;const M=X.current.querySelector(`[role="option"].${s}-focused`);M&&(M.classList.remove(`${s}-focused`),M.classList.remove(`${s}-focusVisible`));let V=X.current;if(X.current.getAttribute("role")!=="listbox"&&(V=X.current.parentElement.querySelector('[role="listbox"]')),!V)return;if(p===-1){V.scrollTop=0;return}const Y=X.current.querySelector(`[data-option-index="${p}"]`);if(Y&&(Y.classList.add(`${s}-focused`),I==="keyboard"&&Y.classList.add(`${s}-focusVisible`),V.scrollHeight>V.clientHeight&&I!=="mouse"&&I!=="touch")){const Z=Y,be=V.clientHeight+V.scrollTop,Tt=Z.offsetTop+Z.offsetHeight;Tt>be?V.scrollTop=Tt-V.clientHeight:Z.offsetTop-Z.offsetHeight*(T?1.3:0)<V.scrollTop&&(V.scrollTop=Z.offsetTop-Z.offsetHeight*(T?1.3:0))}}),pe=Et(({event:m,diff:p,direction:I="next",reason:M="auto"})=>{if(!de)return;const Y=Gt((()=>{const Z=W.length-1;if(p==="reset")return Ct;if(p==="start")return 0;if(p==="end")return Z;const be=B.current+p;return be<0?be===-1&&F?-1:S&&B.current!==-1||Math.abs(p)>1?0:Z:be>Z?be===Z+1&&F?-1:S||Math.abs(p)>1?Z:0:be})(),I);if(Le({index:Y,reason:M,event:m}),o&&p!=="reset")if(Y===-1)A.current.value=z;else{const Z=oe(W[Y]);A.current.value=Z,Z.toLowerCase().indexOf(z.toLowerCase())===0&&z.length>0&&A.current.setSelectionRange(z.length,Z.length)}}),It=()=>{const m=(p,I)=>{const M=p?oe(p):"",V=I?oe(I):"";return M===V};if(B.current!==-1&&fe.filteredOptions&&fe.filteredOptions.length!==W.length&&fe.inputValue===z&&(O?L.length===fe.value.length&&fe.value.every((p,I)=>oe(L[I])===oe(p)):m(fe.value,L))){const p=fe.filteredOptions[B.current];if(p&&W.some(M=>oe(M)===oe(p)))return!0}return!1},rt=x.useCallback(()=>{if(!de||It())return;const m=O?L[0]:L;if(W.length===0||m==null){pe({diff:"reset"});return}if(X.current){if(m!=null){const p=W[B.current];if(O&&p&&ir(L,M=>te(p,M))!==-1)return;const I=ir(W,M=>te(M,m));I===-1?pe({diff:"reset"}):Le({index:I});return}if(B.current>=W.length-1){Le({index:W.length-1});return}Le({index:B.current})}},[W.length,O?!1:L,N,pe,Le,de,z,O]),St=Et(m=>{Fs(X,m),m&&rt()});x.useEffect(()=>{rt()},[rt]);const we=m=>{$e||(wt(!0),jt(!0),Ae&&Ae(m))},Q=(m,p)=>{$e&&(wt(!1),q&&q(m,p))},se=(m,p,I,M)=>{if(O){if(L.length===p.length&&L.every((V,Y)=>V===p[Y]))return}else if(L===p)return;he&&he(m,p,I,M),_e(p)},ne=x.useRef(!1),ue=(m,p,I="selectOption",M="options")=>{let V=I,Y=p;if(O){Y=Array.isArray(L)?L.slice():[];const Z=ir(Y,be=>te(p,be));Z===-1?Y.push(p):M!=="freeSolo"&&(Y.splice(Z,1),V="removeOption")}tt(m,Y),se(m,Y,V,{option:p}),!h&&(!m||!m.ctrlKey&&!m.metaKey)&&Q(m,V),(l===!0||l==="touch"&&ne.current||l==="mouse"&&!ne.current)&&A.current.blur()};function Jt(m,p){if(m===-1)return-1;let I=m;for(;;){if(p==="next"&&I===L.length||p==="previous"&&I===-1)return-1;const M=H.querySelector(`[data-tag-index="${I}"]`);if(!M||!M.hasAttribute("tabindex")||M.disabled||M.getAttribute("aria-disabled")==="true")I+=p==="next"?1:-1;else return I}}const kt=(m,p)=>{if(!O)return;z===""&&Q(m,"toggleInput");let I=ce;ce===-1?z===""&&p==="previous"&&(I=L.length-1):(I+=p==="next"?1:-1,I<0&&(I=0),I===L.length&&(I=-1)),I=Jt(I,p),ut(I),Me(I)},Nt=m=>{b.current=!0,ve(""),K&&K(m,"","clear"),se(m,O?[]:null,"clear")},qt=m=>p=>{if(m.onKeyDown&&m.onKeyDown(p),!p.defaultMuiPrevented&&(ce!==-1&&["ArrowLeft","ArrowRight"].indexOf(p.key)===-1&&(ut(-1),Me(-1)),p.which!==229))switch(p.key){case"Home":de&&j&&(p.preventDefault(),pe({diff:"start",direction:"next",reason:"keyboard",event:p}));break;case"End":de&&j&&(p.preventDefault(),pe({diff:"end",direction:"previous",reason:"keyboard",event:p}));break;case"PageUp":p.preventDefault(),pe({diff:-Br,direction:"previous",reason:"keyboard",event:p}),we(p);break;case"PageDown":p.preventDefault(),pe({diff:Br,direction:"next",reason:"keyboard",event:p}),we(p);break;case"ArrowDown":p.preventDefault(),pe({diff:1,direction:"next",reason:"keyboard",event:p}),we(p);break;case"ArrowUp":p.preventDefault(),pe({diff:-1,direction:"previous",reason:"keyboard",event:p}),we(p);break;case"ArrowLeft":kt(p,"previous");break;case"ArrowRight":kt(p,"next");break;case"Enter":if(B.current!==-1&&de){const I=W[B.current],M=g?g(I):!1;if(p.preventDefault(),M)return;ue(p,I,"selectOption"),o&&A.current.setSelectionRange(A.current.value.length,A.current.value.length)}else v&&z!==""&&Ye===!1&&(O&&p.preventDefault(),ue(p,z,"createOption","freeSolo"));break;case"Escape":de?(p.preventDefault(),p.stopPropagation(),Q(p,"escape")):a&&(z!==""||O&&L.length>0)&&(p.preventDefault(),p.stopPropagation(),Nt(p));break;case"Backspace":if(O&&!Ce&&z===""&&L.length>0){const I=ce===-1?L.length-1:ce,M=L.slice();M.splice(I,1),se(p,M,"removeOption",{option:L[I]})}break;case"Delete":if(O&&!Ce&&z===""&&L.length>0&&ce!==-1){const I=ce,M=L.slice();M.splice(I,1),se(p,M,"removeOption",{option:L[I]})}break}},Xt=m=>{dt(!0),Ge&&!b.current&&we(m)},Rt=m=>{if(e(X)){A.current.focus();return}dt(!1),$.current=!0,b.current=!1,i&&B.current!==-1&&de?ue(m,W[B.current],"blur"):i&&v&&z!==""?ue(m,z,"blur","freeSolo"):c&&tt(m,L),Q(m,"blur")},Yt=m=>{const p=m.target.value;z!==p&&(ve(p),jt(!1),K&&K(m,p,"input")),p===""?!f&&!O&&se(m,null,"clear"):we(m)},Qt=m=>{const p=Number(m.currentTarget.getAttribute("data-option-index"));B.current!==p&&Le({event:m,index:p,reason:"mouse"})},Zt=m=>{Le({event:m,index:Number(m.currentTarget.getAttribute("data-option-index")),reason:"touch"}),ne.current=!0},er=m=>{const p=Number(m.currentTarget.getAttribute("data-option-index"));ue(m,W[p],"selectOption"),ne.current=!1},tr=m=>p=>{const I=L.slice();I.splice(m,1),se(p,I,"removeOption",{option:L[m]})},Mt=m=>{$e?Q(m,"toggleInput"):we(m)},rr=m=>{m.currentTarget.contains(m.target)&&m.target.getAttribute("id")!==ae&&m.preventDefault()},sr=m=>{m.currentTarget.contains(m.target)&&(A.current.focus(),et&&$.current&&A.current.selectionEnd-A.current.selectionStart===0&&A.current.select(),$.current=!1)},or=m=>{!y&&(z===""||!$e)&&Mt(m)};let ht=v&&z.length>0;ht=ht||(O?L.length>0:L!==null);let Lt=W;return T&&(Lt=W.reduce((m,p,I)=>{const M=T(p);return m.length>0&&m[m.length-1].group===M?m[m.length-1].options.push(p):m.push({key:I,index:I,group:M,options:[p]}),m},[])),y&&Xe&&Rt(),{getRootProps:(m={})=>R({"aria-owns":pt?`${ae}-listbox`:null},m,{onKeyDown:qt(m),onMouseDown:rr,onClick:sr}),getInputLabelProps:()=>({id:`${ae}-label`,htmlFor:ae}),getInputProps:()=>({id:ae,value:z,onBlur:Rt,onFocus:Xt,onChange:Yt,onMouseDown:or,"aria-activedescendant":de?"":null,"aria-autocomplete":o?"both":"list","aria-controls":pt?`${ae}-listbox`:void 0,"aria-expanded":pt,autoComplete:"off",ref:A,autoCapitalize:"none",spellCheck:"false",role:"combobox",disabled:y}),getClearProps:()=>({tabIndex:-1,type:"button",onClick:Nt}),getPopupIndicatorProps:()=>({tabIndex:-1,type:"button",onClick:Mt}),getTagProps:({index:m})=>R({key:m,"data-tag-index":m,tabIndex:-1},!Ce&&{onDelete:tr(m)}),getListboxProps:()=>({role:"listbox",id:`${ae}-listbox`,"aria-labelledby":`${ae}-label`,ref:St,onMouseDown:m=>{m.preventDefault()}}),getOptionProps:({index:m,option:p})=>{var I;const M=(O?L:[L]).some(Y=>Y!=null&&te(p,Y)),V=g?g(p):!1;return{key:(I=C==null?void 0:C(p))!=null?I:oe(p),tabIndex:-1,role:"option",id:`${ae}-option-${m}`,onMouseMove:Qt,onClick:er,onTouchStart:Zt,"data-option-index":m,"aria-disabled":V,"aria-selected":M}},id:ae,inputValue:z,value:L,dirty:ht,expanded:de&&H,popupOpen:de,focused:Xe||ce!==-1,anchorEl:H,setAnchorEl:me,focusedTag:ce,groupedOptions:Lt}}const Ro=kr(r.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Mo=kr(r.jsx("path",{d:"M7 10l5 5 5-5z"}),"ArrowDropDown");function Lo(t){return vt("MuiChip",t)}const To=xt("MuiChip",["root","clickable","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","disabled","endDecorator","focusVisible","label","labelSm","labelMd","labelLg","sizeSm","sizeMd","sizeLg","startDecorator","variantPlain","variantSolid","variantSoft","variantOutlined"]),pr=To,Eo=x.createContext({disabled:void 0,variant:void 0,color:void 0}),ds=Eo,Do=["children","className","color","onClick","disabled","size","variant","startDecorator","endDecorator","component","slots","slotProps"],Po=t=>{const{disabled:e,size:s,color:o,clickable:n,variant:i,focusVisible:l}=t,c={root:["root",e&&"disabled",o&&`color${xe(o)}`,s&&`size${xe(s)}`,i&&`variant${xe(i)}`,n&&"clickable"],action:["action",e&&"disabled",l&&"focusVisible"],label:["label",s&&`label${xe(s)}`],startDecorator:["startDecorator"],endDecorator:["endDecorator"]};return yt(c,Lo,{})},Oo=J("div",{name:"JoyChip",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t,ownerState:e})=>{var s,o,n;const i=(s=t.variants[e.variant])==null?void 0:s[e.color],{borderRadius:l}=Bs({theme:t,ownerState:e},["borderRadius"]);return[R({"--Chip-decoratorChildOffset":"min(calc(var(--Chip-paddingInline) - (var(--_Chip-minHeight) - 2 * var(--variant-borderWidth, 0px) - var(--Chip-decoratorChildHeight)) / 2), var(--Chip-paddingInline))","--Chip-decoratorChildRadius":"max(var(--_Chip-radius) - var(--variant-borderWidth, 0px) - var(--_Chip-paddingBlock), min(var(--_Chip-paddingBlock) + var(--variant-borderWidth, 0px), var(--_Chip-radius) / 2))","--Chip-deleteRadius":"var(--Chip-decoratorChildRadius)","--Chip-deleteSize":"var(--Chip-decoratorChildHeight)","--Avatar-radius":"var(--Chip-decoratorChildRadius)","--Avatar-size":"var(--Chip-decoratorChildHeight)","--Icon-margin":"initial","--Icon-color":"currentColor","--unstable_actionRadius":"var(--_Chip-radius)"},e.size==="sm"&&{"--Chip-paddingInline":"0.375rem","--Chip-decoratorChildHeight":"calc(var(--_Chip-minHeight) - 2 * var(--variant-borderWidth))","--Icon-fontSize":t.vars.fontSize.sm,"--_Chip-minHeight":"var(--Chip-minHeight, 1.25rem)",gap:"3px"},e.size==="md"&&{"--Chip-paddingInline":"0.5rem","--Chip-decoratorChildHeight":"calc(var(--_Chip-minHeight) - 0.25rem - 2 * var(--variant-borderWidth))","--Icon-fontSize":t.vars.fontSize.md,"--_Chip-minHeight":"var(--Chip-minHeight, 1.5rem)",gap:"0.25rem"},e.size==="lg"&&{"--Chip-paddingInline":"0.75rem","--Chip-decoratorChildHeight":"calc(var(--_Chip-minHeight) - 0.375rem - 2 * var(--variant-borderWidth))","--Icon-fontSize":t.vars.fontSize.lg,"--_Chip-minHeight":"var(--Chip-minHeight, 1.75rem)",gap:"0.375rem"},{"--_Chip-radius":"var(--Chip-radius, 1.5rem)","--_Chip-paddingBlock":"max((var(--_Chip-minHeight) - 2 * var(--variant-borderWidth, 0px) - var(--Chip-decoratorChildHeight)) / 2, 0px)",minHeight:"var(--_Chip-minHeight)",maxWidth:"max-content",paddingInline:"var(--Chip-paddingInline)",borderRadius:"var(--_Chip-radius)",position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",textDecoration:"none",verticalAlign:"middle",boxSizing:"border-box"},t.typography[`body-${{sm:"xs",md:"sm",lg:"md"}[e.size]}`],{fontWeight:t.vars.fontWeight.md,[`&.${pr.disabled}`]:{color:(o=t.variants[`${e.variant}Disabled`])==null||(o=o[e.color])==null?void 0:o.color}}),...e.clickable?[{"--variant-borderWidth":"0px",color:i==null?void 0:i.color}]:[R({backgroundColor:t.vars.palette.background.surface},i,{[`&.${pr.disabled}`]:(n=t.variants[`${e.variant}Disabled`])==null?void 0:n[e.color]})],l!==void 0&&{"--_Chip-radius":l}]}),Ao=J("span",{name:"JoyChip",slot:"Label",overridesResolver:(t,e)=>e.label})(({ownerState:t})=>R({display:"inline-block",overflow:"hidden",textOverflow:"ellipsis",order:1,minInlineSize:0,flexGrow:1},t.clickable&&{zIndex:1,pointerEvents:"none"})),_o=J("button",{name:"JoyChip",slot:"Action",overridesResolver:(t,e)=>e.action})(({theme:t,ownerState:e})=>{var s,o,n,i;return[{"--Icon-color":e.color!=="neutral"||e.variant==="solid"?"currentColor":t.vars.palette.text.icon,position:"absolute",zIndex:0,top:0,left:0,bottom:0,right:0,width:"100%",border:"none",cursor:"pointer",padding:"initial",margin:"initial",backgroundColor:"initial",textDecoration:"none",borderRadius:"inherit",[t.focus.selector]:t.focus.default},R({backgroundColor:t.vars.palette.background.surface},(s=t.variants[e.variant])==null?void 0:s[e.color]),{"&:hover":{"@media (hover: hover)":(o=t.variants[`${e.variant}Hover`])==null?void 0:o[e.color]}},{"&:active":(n=t.variants[`${e.variant}Active`])==null?void 0:n[e.color]},{[`&.${pr.disabled}`]:(i=t.variants[`${e.variant}Disabled`])==null?void 0:i[e.color]}]}),$o=J("span",{name:"JoyChip",slot:"StartDecorator",overridesResolver:(t,e)=>e.startDecorator})({"--Avatar-marginInlineStart":"calc(var(--Chip-decoratorChildOffset) * -1)","--IconButton-margin":"0 calc(-1 * var(--Chip-paddingInline) / 3) 0 calc(var(--Chip-decoratorChildOffset) * -1)","--Icon-margin":"0 0 0 calc(var(--Chip-paddingInline) / -4)",display:"inherit",order:0,zIndex:1,pointerEvents:"none"}),zo=J("span",{name:"JoyChip",slot:"EndDecorator",overridesResolver:(t,e)=>e.endDecorator})({"--IconButton-margin":"0 calc(var(--Chip-decoratorChildOffset) * -1) 0 calc(-1 * var(--Chip-paddingInline) / 3)","--Icon-margin":"0 calc(var(--Chip-paddingInline) / -4) 0 0",display:"inherit",order:2,zIndex:1,pointerEvents:"none"}),Fo=x.forwardRef(function(e,s){const o=bt({props:e,name:"JoyChip"}),{children:n,className:i,color:l="neutral",onClick:c,disabled:a=!1,size:u="md",variant:d="soft",startDecorator:f,endDecorator:h,component:y,slots:w={},slotProps:S={}}=o,k=Ue(o,Do),N=!!c||!!S.action,v=R({},o,{disabled:a,size:u,color:l,variant:d,clickable:N,focusVisible:!1}),g=typeof S.action=="function"?S.action(v):S.action,C=x.useRef(null),{focusVisible:U,getRootProps:T}=Zr(R({},g,{disabled:a,rootRef:C}));v.focusVisible=U;const j=Po(v),P=R({},k,{component:y,slots:w,slotProps:S}),[F,ee]=re("root",{ref:s,className:zt(j.root,i),elementType:Oo,externalForwardedProps:P,ownerState:v}),[te,O]=re("label",{className:j.label,elementType:Ao,externalForwardedProps:P,ownerState:v}),he=br(O.id),[q,le]=re("action",{className:j.action,elementType:_o,externalForwardedProps:P,ownerState:v,getSlotProps:T,additionalProps:{"aria-labelledby":he,as:g==null?void 0:g.component,onClick:c}}),[K,Ae]=re("startDecorator",{className:j.startDecorator,elementType:$o,externalForwardedProps:P,ownerState:v}),[Re,Ge]=re("endDecorator",{className:j.endDecorator,elementType:zo,externalForwardedProps:P,ownerState:v}),Je=x.useMemo(()=>({disabled:a}),[a]);return r.jsx(ds.Provider,{value:Je,children:r.jsx(es,{variant:d,color:l,children:r.jsxs(F,R({},ee,{children:[N&&r.jsx(q,R({},le)),r.jsx(te,R({},O,{id:he,children:n})),f&&r.jsx(K,R({},Ae,{children:f})),h&&r.jsx(Re,R({},Ge,{children:h}))]}))})})}),ps=Fo,Bo=kr(r.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Cancel");function Vo(t){return vt("MuiChipDelete",t)}xt("MuiChipDelete",["root","disabled","focusVisible","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","variantPlain","variantSolid","variantSoft","variantOutlined"]);var Vr;const Uo=["children","variant","color","disabled","onKeyDown","onDelete","onClick","component","slots","slotProps"],Ho=["onDelete"],Wo=t=>{const{focusVisible:e,variant:s,color:o,disabled:n}=t,i={root:["root",n&&"disabled",e&&"focusVisible",s&&`variant${xe(s)}`,o&&`color${xe(o)}`]};return yt(i,Vo,{})},Ko=J(yr,{name:"JoyChipDelete",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t})=>({"--IconButton-size":"var(--Chip-deleteSize, 2rem)","--Icon-fontSize":"calc(var(--IconButton-size, 2rem) / 1.3)",minWidth:"var(--IconButton-size, 2rem)",minHeight:"var(--IconButton-size, 2rem)",fontSize:t.vars.fontSize.sm,paddingInline:"2px",pointerEvents:"visible",borderRadius:"var(--Chip-deleteRadius, 50%)",zIndex:1,padding:0})),Go=x.forwardRef(function(e,s){const o=bt({props:e,name:"JoyChipDelete"}),{children:n,variant:i="plain",color:l="neutral",disabled:c,onKeyDown:a,onDelete:u,onClick:d,component:f,slots:h={},slotProps:y={}}=o,w=Ue(o,Uo),S=x.useContext(ds),{variant:k=i,color:N=l}=ts(e.variant,e.color,!0),v=e.color||N,g=c??S.disabled,C=x.useRef(null),U=rs(C,s),{focusVisible:T,getRootProps:j}=Zr(R({},o,{disabled:g,rootRef:U})),P=R({},o,{disabled:g,variant:k,color:v,focusVisible:T}),F=Wo(P),ee=R({},w,{component:f,slots:h,slotProps:y}),te=K=>{!g&&u&&u(K),d&&d(K)},O=K=>{["Backspace","Enter","Delete"].includes(K.key)&&(K.preventDefault(),!g&&u&&u(K)),a&&a(K)},[he,q]=re("root",{ref:s,elementType:Ko,getSlotProps:j,externalForwardedProps:ee,ownerState:P,additionalProps:{as:f,onKeyDown:O,onClick:te},className:F.root}),le=Ue(q,Ho);return r.jsx(he,R({},le,{children:n??(Vr||(Vr=r.jsx(Bo,{})))}))}),Jo=Go;function qo(t){return vt("MuiListSubheader",t)}xt("MuiListSubheader",["root","sticky","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","variantPlain","variantSoft","variantOutlined","variantSolid"]);const Xo=["component","className","children","id","sticky","variant","color","slots","slotProps"],Yo=t=>{const{variant:e,color:s,sticky:o}=t,n={root:["root",o&&"sticky",s&&`color${xe(s)}`,e&&`variant${xe(e)}`]};return yt(n,qo,{})},Qo=J("div",{name:"JoyListSubheader",slot:"Root",overridesResolver:(t,e)=>e.root})(({theme:t,ownerState:e})=>{var s,o;return R({boxSizing:"border-box",display:"flex",alignItems:"center",marginInline:"var(--ListItem-marginInline)",paddingBlock:"var(--ListItem-paddingY)",paddingInlineStart:"var(--ListItem-paddingLeft)",paddingInlineEnd:"var(--ListItem-paddingRight)",minBlockSize:"var(--ListItem-minHeight)"},t.typography["body-xs"],{fontSize:"max(0.75em, 0.625rem)",textTransform:"uppercase",letterSpacing:"0.1em"},e.sticky&&{position:"sticky",top:"var(--ListItem-stickyTop, 0px)",zIndex:1,background:"var(--ListItem-stickyBackground)"},{color:e.color?`var(--_Link-color, rgba(${(s=t.vars.palette[e.color])==null?void 0:s.mainChannel} / 1))`:t.vars.palette.text.tertiary},e.instanceColor&&{[`&:not([${Vs}])`]:{"--_Link-color":t.vars.palette.text.secondary}},(o=t.variants[e.variant])==null?void 0:o[e.color])}),Zo=x.forwardRef(function(e,s){const o=bt({props:e,name:"JoyListSubheader"}),{component:n,className:i,children:l,id:c,sticky:a=!1,variant:u,color:d,slots:f={},slotProps:h={}}=o,y=Ue(o,Xo),w=br(c),S=x.useContext(co);x.useEffect(()=>{S&&S(w||"")},[S,w]);const k=R({instanceColor:e.color},o,{id:w,sticky:a,variant:u,color:u?d??"neutral":d}),N=Yo(k),v=R({},y,{component:n,slots:f,slotProps:h}),[g,C]=re("root",{ref:s,className:zt(N.root,i),elementType:Qo,externalForwardedProps:v,ownerState:k,additionalProps:{as:n,id:w}});return r.jsx(g,R({},C,{children:l}))}),en=Zo;function tn(t){return vt("MuiAutocomplete",t)}const rn=xt("MuiAutocomplete",["root","wrapper","input","startDecorator","endDecorator","formControl","focused","disabled","error","multiple","limitTag","hasPopupIcon","hasClearIcon","clearIndicator","popupIndicator","popupIndicatorOpen","listbox","option","loading","noOptions","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","sizeSm","sizeMd","sizeLg","variantPlain","variantOutlined","variantSoft","variantSolid"]),Ve=rn,hs=J(Us)(({theme:t,ownerState:e})=>{var s;const o=(s=t.variants[e.variant])==null?void 0:s[e.color];return R({"--focus-outline-offset":`calc(${t.vars.focus.thickness} * -1)`,"--ListItem-stickyBackground":(o==null?void 0:o.backgroundColor)||(o==null?void 0:o.background)||t.vars.palette.background.popup,"--ListItem-stickyTop":"calc(var(--List-padding, var(--ListDivider-gap)) * -1)"},Ws,{boxShadow:t.shadow.md,borderRadius:`var(--List-radius, ${t.vars.radius.sm})`},!(o!=null&&o.backgroundColor)&&{backgroundColor:t.vars.palette.background.popup},{zIndex:t.vars.zIndex.popup,overflow:"auto",maxHeight:"40vh",position:"relative","&:empty":{visibility:"hidden"},[`& .${Tr.nested}, & .${Tr.nested} .${Hs.root}`]:{position:"initial"}})});J(hs,{name:"JoyAutocompleteListbox",slot:"Root",overridesResolver:(t,e)=>e.root})({});function sn(t){return vt("MuiAutocompleteOption",t)}xt("MuiAutocompleteOption",["root","focused","focusVisible","colorPrimary","colorNeutral","colorDanger","colorSuccess","colorWarning","colorContext","variantPlain","variantSoft","variantOutlined","variantSolid"]);const on=["children","component","color","variant","className","slots","slotProps"],nn=t=>{const{color:e,variant:s}=t,o={root:["root",e&&`color${xe(e)}`,s&&`variant${xe(s)}`]};return yt(o,sn,{})},ms=J(Ks)(({theme:t,ownerState:e})=>{var s,o;return{'&[aria-disabled="true"]':(s=t.variants[`${e.variant}Disabled`])==null?void 0:s[e.color],'&[aria-selected="true"]':R({},(o=t.variants[`${e.variant}Active`])==null?void 0:o[e.color],{fontWeight:t.vars.fontWeight.md})}}),an=J(ms,{name:"JoyAutocompleteOption",slot:"Root",overridesResolver:(t,e)=>e.root})({}),ln=x.forwardRef(function(e,s){const o=bt({props:e,name:"JoyAutocompleteOption"}),{children:n,component:i="li",color:l="neutral",variant:c="plain",className:a,slots:u={},slotProps:d={}}=o,f=Ue(o,on),{variant:h=c,color:y=l}=ts(e.variant,e.color),w=R({},o,{component:i,color:y,variant:h}),S=nn(w),k=R({},f,{component:i,slots:u,slotProps:d}),[N,v]=re("root",{ref:s,className:zt(S.root,a),elementType:an,externalForwardedProps:k,ownerState:w,additionalProps:{as:i,role:"option"}});return r.jsx(N,R({},v,{children:n}))}),cn=ln;var Ur,Hr;const un=["aria-describedby","aria-label","aria-labelledby","autoComplete","autoHighlight","autoSelect","autoFocus","blurOnSelect","clearIcon","clearOnBlur","clearOnEscape","clearText","closeText","defaultValue","disableCloseOnSelect","disabledItemsFocusable","disableListWrap","disableClearable","disabled","endDecorator","error","filterOptions","filterSelectedOptions","forcePopupIcon","freeSolo","getLimitTagsText","getOptionDisabled","getOptionKey","getOptionLabel","handleHomeEndKeys","includeInputInList","isOptionEqualToValue","groupBy","id","inputValue","limitTags","loading","loadingText","multiple","name","noOptionsText","onChange","onClose","onHighlightChange","onInputChange","onOpen","open","openOnFocus","openText","options","placeholder","popupIcon","readOnly","renderGroup","renderOption","renderTags","required","type","startDecorator","size","color","variant","value","component","selectOnFocus","slots","slotProps"],dn=["onDelete"],pn=["onBlur","onFocus","onMouseDown"],hn=t=>t.current!==null&&t.current.contains(document.activeElement),mn=t=>{var e;return(e=t.label)!=null?e:t},fn=t=>`+${t}`,gn=t=>r.jsxs(Ht,{nested:!0,children:[r.jsx(en,{sticky:!0,children:t.group}),r.jsx(ss,{children:t.children})]},t.key),xn=t=>{const{disabled:e,focused:s,hasClearIcon:o,hasPopupIcon:n,popupOpen:i,variant:l,color:c,size:a,multiple:u}=t,d={root:["root",s&&"focused",o&&"hasClearIcon",n&&"hasPopupIcon",l&&`variant${xe(l)}`,c&&`color${xe(c)}`,a&&`size${xe(a)}`],wrapper:["wrapper",u&&"multiple"],input:["input"],startDecorator:["startDecorator"],endDecorator:["endDecorator"],clearIndicator:["clearIndicator"],popupIndicator:["popupIndicator",i&&"popupIndicatorOpen",e&&"disabled"],listbox:["listbox"],option:["option"],loading:["loading"],noOptions:["noOptions"],limitTag:["limitTag"]};return yt(d,tn,{})},vn=J(mo,{name:"JoyAutocomplete",slot:"Root",overridesResolver:(t,e)=>e.root})(({ownerState:t})=>R({},t.size==="sm"&&{"--Autocomplete-wrapperGap":"3px"},t.size==="md"&&{"--Autocomplete-wrapperGap":"3px"},t.size==="lg"&&{"--Autocomplete-wrapperGap":"4px"},{"@media (pointer: fine)":{[`&:hover .${Ve.clearIndicator}`]:{visibility:"visible"}}},t.multiple&&!t.startDecorator&&{paddingInlineStart:0})),bn=J("div",{name:"JoyAutocomplete",slot:"Wrapper",overridesResolver:(t,e)=>e.wrapper})(({ownerState:t})=>({flex:1,minWidth:0,display:"flex",alignItems:"center",flexWrap:"wrap",gap:"var(--Autocomplete-wrapperGap)",[`&.${Ve.multiple}`]:R({paddingBlock:"var(--Autocomplete-wrapperGap)"},!t.startDecorator&&{paddingInlineStart:"var(--Autocomplete-wrapperGap)"},!t.endDecorator&&{paddingInlineEnd:"var(--Autocomplete-wrapperGap)"})})),yn=J(fo,{name:"JoyAutocomplete",slot:"Input",overridesResolver:(t,e)=>e.input})(({ownerState:t})=>R({minWidth:30,minHeight:"var(--Chip-minHeight)"},t.multiple&&{marginInlineStart:"calc(var(--Autocomplete-wrapperGap) * 2.5)"})),Cn=J(go,{name:"JoyAutocomplete",slot:"StartDecorator",overridesResolver:(t,e)=>e.startDecorator})({}),wn=J(xo,{name:"JoyAutocomplete",slot:"EndDecorator",overridesResolver:(t,e)=>e.endDecorator})(({ownerState:t})=>R({},(t.hasClearIcon||t.hasPopupIcon)&&{"--Button-margin":"0px","--IconButton-margin":"0px","--Icon-margin":"0px"})),jn=J(yr,{name:"JoyAutocomplete",slot:"ClearIndicator",overridesResolver:(t,e)=>e.clearIndicator})(({ownerState:t})=>R({alignSelf:"center"},!t.hasPopupIcon&&{marginInlineEnd:"calc(var(--Input-decoratorChildOffset) * -1)"},{marginInlineStart:"calc(var(--_Input-paddingBlock) / 2)",visibility:t.focused?"visible":"hidden"})),In=J(yr,{name:"JoyAutocomplete",slot:"PopupIndicator",overridesResolver:(t,e)=>e.popupIndicator})({alignSelf:"center",marginInlineStart:"calc(var(--_Input-paddingBlock) / 2)",marginInlineEnd:"calc(var(--Input-decoratorChildOffset) * -1)",[`&.${Ve.popupIndicatorOpen}`]:{transform:"rotate(180deg)","--Icon-color":"currentColor"}}),Sn=J(hs,{name:"JoyAutocomplete",slot:"Listbox",overridesResolver:(t,e)=>e.listbox})(({theme:t})=>({zIndex:`var(--unstable_popup-zIndex, ${t.vars.zIndex.popup})`})),kn=J(ms,{name:"JoyAutocomplete",slot:"Option",overridesResolver:(t,e)=>e.option})({}),Nn=J(Ht,{name:"JoyAutocomplete",slot:"Loading",overridesResolver:(t,e)=>e.loading})(({theme:t})=>({color:(t.vars||t).palette.text.secondary})),Rn=J(Ht,{name:"JoyAutocomplete",slot:"NoOptions",overridesResolver:(t,e)=>e.noOptions})(({theme:t})=>({color:(t.vars||t).palette.text.secondary})),Mn=J("div",{name:"JoyAutocomplete",slot:"NoOptions",overridesResolver:(t,e)=>e.noOptions})({marginInlineStart:"calc(var(--Input-paddingInline) / 2)",marginBlockStart:"var(--_Input-paddingBlock)"}),Ln=x.forwardRef(function(e,s){var o,n,i,l,c,a,u;const d=bt({props:e,name:"JoyAutocomplete"}),{"aria-describedby":f,"aria-label":h,"aria-labelledby":y,autoFocus:w,clearIcon:S=Ur||(Ur=r.jsx(Ro,{fontSize:"md"})),clearText:k="Clear",closeText:N="Close",disableClearable:v=!1,disabled:g,endDecorator:C,error:U=!1,forcePopupIcon:T="auto",freeSolo:j=!1,getLimitTagsText:P=fn,getOptionLabel:F=mn,groupBy:ee,id:te,limitTags:O=-1,loading:he=!1,loadingText:q="Loadingâ€¦",multiple:le=!1,name:K,noOptionsText:Ae="No options",openText:Re="Open",placeholder:Ge,popupIcon:Je=Hr||(Hr=r.jsx(Mo,{})),readOnly:Ce=!1,renderGroup:et=gn,renderOption:qe,renderTags:ae,required:oe,type:b,startDecorator:$,size:A="md",color:X="neutral",variant:H="outlined",component:me,slots:ce={},slotProps:ut={}}=d,Ct=Ue(d,un),B=x.useContext(vo),L=(o=(n=e.error)!=null?n:B==null?void 0:B.error)!=null?o:U,_e=(i=(l=e.size)!=null?l:B==null?void 0:B.size)!=null?i:A,z=(c=e.color)!=null?c:L?"danger":(a=B==null?void 0:B.color)!=null?a:X,ve=(u=g??(B==null?void 0:B.disabled))!=null?u:!1,{getRootProps:Xe,getInputProps:dt,getPopupIndicatorProps:tt,getClearProps:$e,getTagProps:wt,getListboxProps:Kt,getOptionProps:jt,value:Ye,dirty:de,popupOpen:W,focused:fe,focusedTag:pt,anchorEl:Me,setAnchorEl:Gt,inputValue:Le,groupedOptions:pe}=No(R({},d,{id:te??(B==null?void 0:B.htmlFor),componentName:"Autocomplete",unstable_classNamePrefix:"Mui",unstable_isActiveElementInListbox:hn})),{onMouseDown:It}=dt(),{onClick:rt}=Xe(),St=!v&&!ve&&de&&!Ce,we=(!j||T===!0)&&T!==!1,Q=R({instanceColor:e.color},d,{value:Ye,disabled:ve,focused:fe,getOptionLabel:F,hasOptions:!!pe.length,hasClearIcon:St,hasPopupIcon:we,inputFocused:pt===-1,popupOpen:W,size:_e,color:z,variant:H}),se=xn(Q),ne=R({},Ct,{component:me,slots:ce,slotProps:ut});let ue;if(le&&Ye.length>0){const D=ye=>{const ie=wt(ye),{onDelete:st}=ie,ot=Ue(ie,dn);return R({disabled:ve,size:_e,onClick:st},ot)};ae?ue=ae(Ye,D,Q):ue=Ye.map((ye,ie)=>r.jsx(ps,{size:_e,variant:"soft",color:"neutral",endDecorator:r.jsx(Jo,R({},D({index:ie}))),sx:{minWidth:0},children:F(ye)},ie))}const Jt=rs(s,Gt),kt={[Ve.disabled]:ve,[Ve.error]:L,[Ve.focused]:fe,[Ve.formControl]:!!B},[Nt,qt]=re("root",{ref:Jt,className:[se.root,kt],elementType:vn,externalForwardedProps:ne,ownerState:Q,getSlotProps:Xe,additionalProps:{onClick:D=>{rt&&rt(D),D.currentTarget===D.target&&It&&It(D)}}}),[Xt,Rt]=re("wrapper",{className:se.wrapper,elementType:bn,externalForwardedProps:ne,ownerState:Q}),Yt={[Ve.disabled]:ve},[Qt,Zt]=re("input",{className:[se.input,Yt],elementType:yn,getSlotProps:D=>{const ye=dt(),{onBlur:ie,onFocus:st,onMouseDown:ot}=ye,zs=Ue(ye,pn);return R({},zs,{onBlur:ze=>{var Fe;ie==null||ie(ze),(Fe=D.onBlur)==null||Fe.call(D,ze)},onFocus:ze=>{var Fe;st==null||st(ze),(Fe=D.onFocus)==null||Fe.call(D,ze)},onMouseDown:ze=>{var Fe;ot==null||ot(ze),(Fe=D.onMouseDown)==null||Fe.call(D,ze)}})},externalForwardedProps:ne,ownerState:Q,additionalProps:{autoFocus:w,placeholder:Ge,name:K,readOnly:Ce,disabled:ve,required:oe??(B==null?void 0:B.required),type:b,"aria-invalid":L||void 0,"aria-label":h,"aria-labelledby":y,"aria-describedby":f??(B==null?void 0:B["aria-describedby"])}}),[er,tr]=re("startDecorator",{className:se.startDecorator,elementType:Cn,externalForwardedProps:ne,ownerState:Q}),[Mt,rr]=re("endDecorator",{className:se.endDecorator,elementType:wn,externalForwardedProps:ne,ownerState:Q}),[sr,or]=re("clearIndicator",{className:se.clearIndicator,elementType:jn,getSlotProps:$e,externalForwardedProps:ne,ownerState:Q,getSlotOwnerState:D=>({size:D.size||_e,variant:D.variant||nt(H,z).variant||"plain",color:D.color||nt(H,z).color||"neutral",disableColorInversion:!!e.color}),additionalProps:{"aria-label":k,title:k}}),[ht,Lt]=re("popupIndicator",{className:se.popupIndicator,elementType:In,getSlotProps:tt,externalForwardedProps:ne,ownerState:Q,getSlotOwnerState:D=>({size:D.size||_e,variant:D.variant||nt(H,z).variant||"plain",color:D.color||nt(H,z).color||"neutral",disableColorInversion:!!e.color}),additionalProps:{disabled:ve,"aria-label":W?N:Re,title:W?N:Re,type:"button"}}),[m,p]=re("listbox",{className:se.listbox,elementType:Sn,getSlotProps:Kt,externalForwardedProps:ne,ownerState:Q,getSlotOwnerState:D=>({size:D.size||_e,variant:D.variant||H,color:D.color||z,disableColorInversion:!D.disablePortal}),additionalProps:{anchorEl:Me,open:W,style:Me?{width:Me.clientWidth}:{}}}),[I,M]=re("loading",{className:se.loading,elementType:Nn,externalForwardedProps:ne,ownerState:Q}),[V,Y]=re("noOptions",{className:se.noOptions,elementType:Rn,externalForwardedProps:ne,ownerState:Q,additionalProps:{role:"presentation",onMouseDown:D=>{D.preventDefault()}}}),[Z,be]=re("limitTag",{className:se.limitTag,elementType:Mn,externalForwardedProps:ne,ownerState:Q});if(O>-1&&Array.isArray(ue)){const D=ue.length-O;!fe&&D>0&&(ue=ue.splice(0,O),ue.push(r.jsx(Z,R({},be,{children:P(D)}),ue.length)))}const[Tt,As]=re("option",{className:se.option,elementType:kn,externalForwardedProps:ne,ownerState:Q,getSlotOwnerState:D=>({variant:D.variant||nt(H,z).variant||"plain",color:D.color||nt(H,z).color||"neutral",disableColorInversion:!p.disablePortal}),additionalProps:{as:"li"}}),_s=qe||((D,ye)=>r.jsx(Tt,R({},D,{children:F(ye)}))),Rr=(D,ye)=>{const ie=jt({option:D,index:ye});return _s(R({},As,ie),D,{selected:!!ie["aria-selected"],inputValue:Le,ownerState:Q})},$s=x.useMemo(()=>[{name:"offset",options:{offset:[0,4]}},...p.modifiers||[]],[p.modifiers]);let Mr=null;if(Me){var Lr;Mr=r.jsx(es,{variant:H,color:z,children:r.jsx(Gs,{nested:!0,children:r.jsxs(m,R({},p,{className:zt(p.className),modifiers:$s},!((Lr=d.slots)!=null&&Lr.listbox)&&{as:Js,slots:{root:p.as||"ul"}},{children:[pe.map((D,ye)=>{if(ee){const ie=D;return et({key:String(ie.key),group:ie.group,children:ie.options.map((st,ot)=>Rr(st,ie.index+ot))})}return Rr(D,ye)}),he&&pe.length===0?r.jsx(I,R({},M,{children:q})):null,pe.length===0&&!j&&!he?r.jsx(V,R({},Y,{children:Ae})):null]}))})})}return r.jsxs(x.Fragment,{children:[r.jsxs(Nt,R({},qt,{children:[$&&r.jsx(er,R({},tr,{children:$})),r.jsxs(Xt,R({},Rt,{children:[ue,r.jsx(Qt,R({},Zt))]})),C&&r.jsx(Mt,R({},rr,{children:C})),St?r.jsx(sr,R({},or,{children:S})):null,we?r.jsx(ht,R({},Lt,{children:Je})):null]})),Mr]})}),fs=Ln;function Tn(t){return t&&t.length?qs(t):[]}const Wt=()=>{const t=os(c=>c.tag),e=De();return{state:t,getState:()=>Te.getState().tag,fetchTags:async()=>{const{tags:c}=await Dt.listTags({user:e.name});Te.dispatch(Xs(c.map(a=>a.name)))},upsertTag:async c=>{await Dt.upsertTag({name:c}),Te.dispatch(Er(c))},batchUpsertTag:async c=>{await Dt.batchUpsertTag({requests:c.map(a=>({name:a}))});for(const a of c)Te.dispatch(Er(a))},deleteTag:async c=>{await Dt.deleteTag({tag:{name:c,creator:e.name}}),Te.dispatch(Ys(c))}}},gs=()=>{const t=os(n=>n.resource),e=He(),o=Cr().state.systemStatus.maxUploadSizeMiB;return{state:t,getState:()=>Te.getState().resource,async createResource(n){const{resource:i}=await Dr.createResource(n);if(!i)throw new Error("resource is null");const l=t.resources;return Te.dispatch(Pr([i,...l])),i},async createResourceWithBlob(n){const{name:i,size:l}=n;if(l>o*1024*1024)return Promise.reject(e("message.maximum-upload-size-is",{size:o}));const c=new FormData;c.append("file",n,i);const{data:a}=await Qs(c),u=t.resources;return Te.dispatch(Pr([a,...u])),a},async updateResource(n){const{resource:i}=await Dr.updateResource(n);if(!i)throw new Error("resource is null");return Te.dispatch(Zs(i)),i}}},En=t=>{const e=He(),{destroy:s,memoId:o}=t,n=We(),[i,l]=x.useState(""),c=Ar();x.useEffect(()=>{n.getOrFetchMemoById(o).then(f=>{if(f){const h=Ar(f.createTime);l(h)}else Se.error(e("message.memo-not-found")),s()})},[]);const a=()=>{s()},u=f=>{const h=f.target.value;l(h)},d=async()=>{try{await n.updateMemo({id:o,createTime:new Date(i)},["created_ts"]),Se.success(e("message.memo-updated-datetime")),a()}catch(f){console.error(f),Se.error(f.response.data.message)}};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"dialog-header-container",children:[r.jsx("p",{className:"title-text",children:e("message.change-memo-created-time")}),r.jsx(Ne,{size:"sm",onClick:a,children:r.jsx(_.X,{className:"w-5 h-auto"})})]}),r.jsxs("div",{className:"flex flex-col justify-start items-start !w-72 max-w-full",children:[r.jsx(dr,{className:"w-full",type:"datetime-local",value:i,slotProps:{input:{max:c}},onChange:u}),r.jsxs("div",{className:"flex flex-row justify-end items-center mt-4 w-full gap-x-2",children:[r.jsx(ke,{color:"neutral",variant:"plain",onClick:a,children:e("common.cancel")}),r.jsx(ke,{color:"primary",onClick:d,children:e("common.save")})]})]})]})};function Dn(t){lt({className:"change-memo-created-ts-dialog",dialogName:"change-memo-created-ts-dialog"},En,{memoId:t})}const Ci=/#([^\s#,]+)/,Pn=t=>{const e=window.parse(t),s=new Set,o=(n,i)=>{for(const l of n)if(l&&(i(l),l.type==="PARAGRAPH"||l.type==="ORDERED_LIST"||l.type==="UNORDERED_LIST")){const c=l.value.children;Array.isArray(c)&&o(c,i)}};return o(e,n=>{n.type==="TAG"&&n.value&&s.add(n.value.content)}),Array.from(s)},On=["image/*","text/*","audio/*","video/*","application/*"],An=t=>{const e=He(),{destroy:s,onCancel:o,onConfirm:n}=t,i=gs(),[l,c]=x.useState({selectedMode:"local-file",uploadingFlag:!1}),[a,u]=x.useState({filename:"",externalLink:"",type:""}),[d,f]=x.useState([]),h=x.useRef(null),y=(T,j)=>{const P=d.findIndex(ee=>ee.name===T);if(P===-1)return;const F=[...d];if(j==="up"){if(P===0)return;const ee=F[P-1];F[P-1]=F[P],F[P]=ee}else if(j==="down"){if(P===d.length-1)return;const ee=F[P+1];F[P+1]=F[P],F[P]=ee}f(F)},w=()=>{o&&o(),s()},S=T=>{c(j=>({...j,selectedMode:T}))},k=T=>{const j=T.target.value;u(P=>({...P,externalLink:j}))},N=T=>{const j=T.target.value;u(P=>({...P,filename:j}))},v=T=>{u(j=>({...j,type:T}))},g=async()=>{if(!h.current||!h.current.files)return;const T=[];for(const j of h.current.files)T.push(j);f(T)},C=()=>{if(l.selectedMode==="local-file"){if(!h.current||!h.current.files||h.current.files.length===0)return!1}else if(l.selectedMode==="external-link"&&(a.filename===""||a.externalLink===""||a.type===""))return!1;return!0},U=async()=>{if(l.uploadingFlag)return;c(j=>({...j,uploadingFlag:!0}));const T=[];try{if(l.selectedMode==="local-file"){if(!h.current||!h.current.files)return;const j=Array.from(h.current.files);for(const P of d){if(!j.find(te=>te.name===P.name))continue;const ee=await i.createResourceWithBlob(P);T.push(ee)}}else{const j=await i.createResource(a);T.push(j)}}catch(j){console.error(j),Se.error(typeof j=="string"?j:j.response.data.message)}n&&n(T),s()};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"dialog-header-container",children:[r.jsx("p",{className:"title-text",children:e("resource.create-dialog.title")}),r.jsx(Ne,{size:"sm",onClick:w,children:r.jsx(_.X,{className:"w-5 h-auto"})})]}),r.jsxs("div",{className:"dialog-content-container !w-80",children:[r.jsx(mt,{className:"!mb-1",level:"body-md",children:e("resource.create-dialog.upload-method")}),r.jsxs(Sr,{className:"w-full mb-2",onChange:(T,j)=>S(j),value:l.selectedMode,startDecorator:r.jsx(_.File,{className:"w-4 h-auto"}),children:[r.jsx(_t,{value:"local-file",children:e("resource.create-dialog.local-file.option")}),r.jsx(_t,{value:"external-link",children:e("resource.create-dialog.external-link.option")})]}),l.selectedMode==="local-file"&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"w-full relative bg-blue-50 dark:bg-zinc-900 rounded-md flex flex-row justify-center items-center py-8",children:[r.jsx("label",{htmlFor:"files",className:"p-2 px-4 text-sm text-white cursor-pointer bg-blue-500 block rounded hover:opacity-80",children:e("resource.create-dialog.local-file.choose")}),r.jsx("input",{className:"absolute inset-0 w-full h-full opacity-0",ref:h,onChange:g,type:"file",id:"files",multiple:!0,accept:"*"})]}),r.jsx(ss,{size:"sm",sx:{width:"100%"},children:d.map((T,j)=>r.jsxs(Ht,{className:"flex justify-between",children:[r.jsx(mt,{noWrap:!0,children:T.name}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{onClick:()=>{y(T.name,"up")},disabled:j===0,className:"disabled:opacity-50",children:r.jsx(_.ArrowUp,{className:"w-4 h-4"})}),r.jsx("button",{onClick:()=>{y(T.name,"down")},disabled:j===d.length-1,className:"disabled:opacity-50",children:r.jsx(_.ArrowDown,{className:"w-4 h-4"})})]})]},T.name))})]}),l.selectedMode==="external-link"&&r.jsxs(r.Fragment,{children:[r.jsx(mt,{className:"!mb-1",level:"body-md",children:e("resource.create-dialog.external-link.link")}),r.jsx(dr,{className:"mb-2",placeholder:e("resource.create-dialog.external-link.link-placeholder"),value:a.externalLink,onChange:k,fullWidth:!0}),r.jsx(mt,{className:"!mb-1",level:"body-md",children:e("resource.create-dialog.external-link.file-name")}),r.jsx(dr,{className:"mb-2",placeholder:e("resource.create-dialog.external-link.file-name-placeholder"),value:a.filename,onChange:N,fullWidth:!0}),r.jsx(mt,{className:"!mb-1",level:"body-md",children:e("resource.create-dialog.external-link.type")}),r.jsx(fs,{className:"w-full",size:"sm",placeholder:e("resource.create-dialog.external-link.type-placeholder"),freeSolo:!0,options:On,onChange:(T,j)=>v(j||"")})]}),r.jsxs("div",{className:"mt-2 w-full flex flex-row justify-end items-center space-x-1",children:[r.jsx(ke,{variant:"plain",color:"neutral",onClick:w,children:e("common.cancel")}),r.jsx(ke,{onClick:U,loading:l.uploadingFlag,disabled:!C(),children:e("common.create")})]})]})]})};function _n(t){lt({dialogName:"create-resource-dialog"},An,t)}const $n=t=>{const{destroy:e,onConfirm:s}=t,o=He(),n=De(),[i,l]=x.useState(""),[c,a]=x.useState(!0),[u,d]=x.useState([]),[f,h]=x.useState([]),[y,w]=x.useState(!1),S=u.filter(g=>!f.includes(g));lo(async()=>{a(!0);try{const g=[`creator == "${n.name}"`,'row_status == "NORMAL"'];i&&g.push(`content_search == [${JSON.stringify(i)}]`);const{memos:C}=await je.listMemos({pageSize:po,filter:g.length>0?g.join(" && "):void 0});d(C)}catch(g){console.error(g),Se.error(g.response.data.message)}a(!1)},300,[i]);const k=g=>{const C=g.toLowerCase().indexOf(i.toLowerCase());if(C===-1)return g;let U=g.slice(0,C);U.length>20&&(U="..."+U.slice(U.length-20));const T=g.slice(C,C+i.length);let j=g.slice(C+i.length);return j.length>20&&(j=j.slice(0,20)+"..."),r.jsxs(r.Fragment,{children:[U,r.jsx("mark",{className:"font-medium",children:T}),j]})},N=()=>{e()},v=async()=>{s(f,y),e()};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"dialog-header-container !w-96",children:[r.jsx("p",{className:"title-text",children:"Add references"}),r.jsx(Ne,{size:"sm",onClick:()=>e(),children:r.jsx(_.X,{className:"w-5 h-auto"})})]}),r.jsxs("div",{className:"dialog-content-container max-w-[24rem]",children:[r.jsx(fs,{className:"w-full",size:"md",clearOnBlur:!0,disableClearable:!0,placeholder:"Search content",noOptionsText:"No memos found",options:S,loading:c,inputValue:i,value:f,multiple:!0,onInputChange:(g,C)=>l(C.trim()),getOptionKey:g=>g.name,getOptionLabel:g=>g.content,isOptionEqualToValue:(g,C)=>g.id===C.id,renderOption:(g,C)=>r.jsx(cn,{...g,children:r.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[r.jsx("p",{className:"text-xs text-gray-400 select-none",children:ft(C.displayTime)}),r.jsx("p",{className:"mt-0.5 text-sm leading-5 line-clamp-2",children:i?k(C.content):C.content})]})}),renderTags:g=>g.map(C=>r.jsx(ps,{className:"!max-w-full !rounded",variant:"outlined",color:"neutral",children:r.jsxs("div",{className:"w-full flex flex-col justify-start items-start",children:[r.jsx("p",{className:"text-xs text-gray-400 select-none",children:ft(C.displayTime)}),r.jsx("span",{className:"w-full text-sm leading-5 truncate",children:C.content})]})},C.name)),onChange:(g,C)=>h(C)}),r.jsx("div",{className:"mt-3",children:r.jsx(bo,{label:"Use as Embedded Content",checked:y,onChange:g=>w(g.target.checked)})}),r.jsxs("div",{className:"mt-4 w-full flex flex-row justify-end items-center space-x-1",children:[r.jsx(ke,{variant:"plain",color:"neutral",onClick:N,children:o("common.cancel")}),r.jsx(ke,{onClick:v,disabled:f.length===0,children:o("common.confirm")})]})]})]})};function zn(t){lt({className:"create-memo-relation-dialog",dialogName:"create-memo-relation-dialog"},$n,t)}const xs=x.createContext({relationList:[],setRelationList:()=>{}}),Fn=t=>{const{editorRef:e}=t,s=x.useContext(xs),o=()=>{zn({onConfirm:(n,i)=>{if(i){if(!e.current){Ot.error("Failed to embed memo");return}const l=e.current.getCursorPosition(),c=e.current.getContent().slice(0,l);c!==""&&!c.endsWith(`
`)&&e.current.insertText(`
`);for(const a of n)e.current.insertText(`![[memos/${a.name}]]
`);setTimeout(()=>{var a,u;(a=e.current)==null||a.scrollToCursor(),(u=e.current)==null||u.focus()});return}s.setRelationList(eo([...n.map(l=>({memoId:s.memoId||gt,relatedMemoId:l.id,type:it.REFERENCE})),...s.relationList].filter(l=>l.relatedMemoId!==(s.memoId||gt)),"relatedMemoId"))}})};return r.jsx(Ne,{size:"sm",onClick:o,children:r.jsx(_.Link,{className:"w-5 h-5 mx-auto"})})},Bn=({content:t,destroy:e})=>{const s=()=>{e()};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"dialog-header-container",children:[r.jsx("div",{className:"flex flex-row justify-start items-center",children:r.jsx("p",{className:"text-black opacity-80 dark:text-gray-200",children:"Preview"})}),r.jsx(Ne,{size:"sm",onClick:s,children:r.jsx(_.X,{className:"w-5 h-auto"})})]}),r.jsx("div",{className:"flex flex-col justify-start items-start max-w-full w-[32rem]",children:t!==""?r.jsx(wr,{content:t}):r.jsx("p",{className:"text-gray-400 dark:text-gray-600",children:"Nothing to preview"})})]})};function Vn(t){lt({className:"preview-markdown-dialog",dialogName:"preview-markdown-dialog",containerClassName:"dark:!bg-zinc-800"},Bn,{content:t})}const Un=t=>{const{editorRef:e}=t,s=()=>{if(!e.current)return;const i=e.current.getCursorPosition(),l=e.current.getContent().slice(0,i);l===""||l.endsWith(`
`)?e.current.insertText("","```\n","\n```"):e.current.insertText("","\n```\n","\n```"),setTimeout(()=>{var c,a;(c=e.current)==null||c.scrollToCursor(),(a=e.current)==null||a.focus()})},o=()=>{if(!e.current)return;const i=e.current.getCursorPosition(),l=e.current.getCursorLineNumber(),c=e.current.getLine(l);let a="",u=0;if(/^- \[( |x|X)\] /.test(c))a=c.replace(/^- \[( |x|X)\] /,""),u=-6;else if(/^\d+\. |- /.test(c)){const d=c.match(/^\d+\. |- /)??[""];a=c.replace(/^\d+\. |- /,"- [ ] "),u=-d[0].length+6}else a="- [ ] "+c,u=6;e.current.setLine(l,a),e.current.setCursorPosition(i+u),setTimeout(()=>{var d,f;(d=e.current)==null||d.scrollToCursor(),(f=e.current)==null||f.focus()})},n=()=>{var l,c;if((((l=e.current)==null?void 0:l.getContent())??"")===""){Ot.error("Nothing to preview");return}Vn(((c=e.current)==null?void 0:c.getContent())??"")};return r.jsxs(Ft,{children:[r.jsx(Bt,{slots:{root:Ne},slotProps:{root:{size:"sm"}},children:r.jsx(_.SquareSlash,{className:"w-5 h-5 mx-auto"})}),r.jsxs(Vt,{className:"text-sm",size:"sm",placement:"bottom-start",children:[r.jsxs(Be,{onClick:s,children:[r.jsx(_.Code2,{className:"w-4 h-auto"}),r.jsx("span",{children:"Code block"})]}),r.jsxs(Be,{onClick:o,children:[r.jsx(_.CheckSquare,{className:"w-4 h-auto"}),r.jsx("span",{children:"Checkbox"})]}),r.jsxs(Be,{onClick:n,children:[r.jsx(_.GanttSquare,{className:"w-4 h-auto"}),r.jsx("span",{children:"Preview"})]}),r.jsx("div",{className:"-mt-0.5 pl-2",children:r.jsx(yo,{fontSize:12,href:"https://www.usememos.com/docs/getting-started/content-syntax",target:"_blank",children:"Content syntax"})})]})]})};var vs={};Object.defineProperty(vs,"__esModule",{value:!0});var lr=x,Wr=to,Hn=["mousedown","touchstart"],Wn=function(t,e,s){s===void 0&&(s=Hn);var o=lr.useRef(e);lr.useEffect(function(){o.current=e},[e]),lr.useEffect(function(){for(var n=function(a){var u=t.current;u&&!u.contains(a.target)&&o.current(a)},i=0,l=s;i<l.length;i++){var c=l[i];Wr.on(document,c,n)}return function(){for(var a=0,u=s;a<u.length;a++){var d=u[a];Wr.off(document,d,n)}}},[s,t])},bs=vs.default=Wn;const ys=({children:t,className:e})=>{const[s,o]=x.useState(!1),n=x.useRef(null);return x.useEffect(()=>{n.current&&o(n.current.scrollWidth>n.current.clientWidth)},[]),r.jsx(Ze,{title:t,placement:"top",arrow:!0,disableHoverListener:!s,children:r.jsx("div",{ref:n,className:Pe("truncate",e),children:t})})},Kn=t=>{const{editorRef:e}=t,s=Wt(),[o,n]=x.useState(!1),i=x.useRef(null),l=s.state.tags;x.useEffect(()=>{(async()=>{try{await s.fetchTags()}catch{}})()},[]),bs(i,()=>{n(!1)});const c=a=>{const u=e.current;if(u===null)return;const d=u.getLine(u.getCursorLineNumber()),f=d.slice(-1);f!==" "&&f!=="ã€€"&&d!==""&&u.insertText(`
`),u.insertText(`#${a} `)};return r.jsxs(Ft,{open:o,onOpenChange:(a,u)=>n(u),children:[r.jsx(Bt,{slots:{root:Ne},slotProps:{root:{size:"sm"}},children:r.jsx(_.Hash,{className:"w-5 h-5 mx-auto"})}),r.jsx(Vt,{className:"relative text-sm",component:"div",size:"sm",placement:"bottom-start",children:r.jsx("div",{ref:i,children:l.length>0?r.jsx("div",{className:"flex-row justify-start items-start flex-wrap px-1 max-w-[12rem] h-auto max-h-48 overflow-y-auto font-mono",children:l.map(a=>r.jsx("div",{className:"inline-flex w-auto max-w-full cursor-pointer rounded text-sm leading-5 px-1 text-gray-500 dark:text-gray-400 hover:bg-zinc-100 dark:hover:bg-zinc-800",onClick:()=>c(a),children:r.jsxs(ys,{children:["#",a]})},a))}):r.jsx("p",{className:"italic mx-2",onClick:a=>a.stopPropagation(),children:"No tag found"})})})]})};function Oe(t){return Array.isArray?Array.isArray(t):js(t)==="[object Array]"}const Gn=1/0;function Jn(t){if(typeof t=="string")return t;let e=t+"";return e=="0"&&1/t==-Gn?"-0":e}function qn(t){return t==null?"":Jn(t)}function Ie(t){return typeof t=="string"}function Cs(t){return typeof t=="number"}function Xn(t){return t===!0||t===!1||Yn(t)&&js(t)=="[object Boolean]"}function ws(t){return typeof t=="object"}function Yn(t){return ws(t)&&t!==null}function ge(t){return t!=null}function cr(t){return!t.trim().length}function js(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const Qn="Incorrect 'index' type",Zn=t=>`Invalid value for key ${t}`,ea=t=>`Pattern length exceeds max of ${t}.`,ta=t=>`Missing ${t} property in key`,ra=t=>`Property 'weight' in key '${t}' must be a positive integer`,Kr=Object.prototype.hasOwnProperty;class sa{constructor(e){this._keys=[],this._keyMap={};let s=0;e.forEach(o=>{let n=Is(o);this._keys.push(n),this._keyMap[n.id]=n,s+=n.weight}),this._keys.forEach(o=>{o.weight/=s})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function Is(t){let e=null,s=null,o=null,n=1,i=null;if(Ie(t)||Oe(t))o=t,e=Gr(t),s=hr(t);else{if(!Kr.call(t,"name"))throw new Error(ta("name"));const l=t.name;if(o=l,Kr.call(t,"weight")&&(n=t.weight,n<=0))throw new Error(ra(l));e=Gr(l),s=hr(l),i=t.getFn}return{path:e,id:s,weight:n,src:o,getFn:i}}function Gr(t){return Oe(t)?t:t.split(".")}function hr(t){return Oe(t)?t.join("."):t}function oa(t,e){let s=[],o=!1;const n=(i,l,c)=>{if(ge(i))if(!l[c])s.push(i);else{let a=l[c];const u=i[a];if(!ge(u))return;if(c===l.length-1&&(Ie(u)||Cs(u)||Xn(u)))s.push(qn(u));else if(Oe(u)){o=!0;for(let d=0,f=u.length;d<f;d+=1)n(u[d],l,c+1)}else l.length&&n(u,l,c+1)}};return n(t,Ie(e)?e.split("."):e,0),o?s:s[0]}const na={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},aa={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,e)=>t.score===e.score?t.idx<e.idx?-1:1:t.score<e.score?-1:1},ia={location:0,threshold:.6,distance:100},la={useExtendedSearch:!1,getFn:oa,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var E={...aa,...na,...ia,...la};const ca=/[^ ]+/g;function ua(t=1,e=3){const s=new Map,o=Math.pow(10,e);return{get(n){const i=n.match(ca).length;if(s.has(i))return s.get(i);const l=1/Math.pow(i,.5*t),c=parseFloat(Math.round(l*o)/o);return s.set(i,c),c},clear(){s.clear()}}}class Nr{constructor({getFn:e=E.getFn,fieldNormWeight:s=E.fieldNormWeight}={}){this.norm=ua(s,3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((s,o)=>{this._keysMap[s.id]=o})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ie(this.docs[0])?this.docs.forEach((e,s)=>{this._addString(e,s)}):this.docs.forEach((e,s)=>{this._addObject(e,s)}),this.norm.clear())}add(e){const s=this.size();Ie(e)?this._addString(e,s):this._addObject(e,s)}removeAt(e){this.records.splice(e,1);for(let s=e,o=this.size();s<o;s+=1)this.records[s].i-=1}getValueForItemAtKeyId(e,s){return e[this._keysMap[s]]}size(){return this.records.length}_addString(e,s){if(!ge(e)||cr(e))return;let o={v:e,i:s,n:this.norm.get(e)};this.records.push(o)}_addObject(e,s){let o={i:s,$:{}};this.keys.forEach((n,i)=>{let l=n.getFn?n.getFn(e):this.getFn(e,n.path);if(ge(l)){if(Oe(l)){let c=[];const a=[{nestedArrIndex:-1,value:l}];for(;a.length;){const{nestedArrIndex:u,value:d}=a.pop();if(ge(d))if(Ie(d)&&!cr(d)){let f={v:d,i:u,n:this.norm.get(d)};c.push(f)}else Oe(d)&&d.forEach((f,h)=>{a.push({nestedArrIndex:h,value:f})})}o.$[i]=c}else if(Ie(l)&&!cr(l)){let c={v:l,n:this.norm.get(l)};o.$[i]=c}}}),this.records.push(o)}toJSON(){return{keys:this.keys,records:this.records}}}function Ss(t,e,{getFn:s=E.getFn,fieldNormWeight:o=E.fieldNormWeight}={}){const n=new Nr({getFn:s,fieldNormWeight:o});return n.setKeys(t.map(Is)),n.setSources(e),n.create(),n}function da(t,{getFn:e=E.getFn,fieldNormWeight:s=E.fieldNormWeight}={}){const{keys:o,records:n}=t,i=new Nr({getFn:e,fieldNormWeight:s});return i.setKeys(o),i.setIndexRecords(n),i}function Pt(t,{errors:e=0,currentLocation:s=0,expectedLocation:o=0,distance:n=E.distance,ignoreLocation:i=E.ignoreLocation}={}){const l=e/t.length;if(i)return l;const c=Math.abs(o-s);return n?l+c/n:c?1:l}function pa(t=[],e=E.minMatchCharLength){let s=[],o=-1,n=-1,i=0;for(let l=t.length;i<l;i+=1){let c=t[i];c&&o===-1?o=i:!c&&o!==-1&&(n=i-1,n-o+1>=e&&s.push([o,n]),o=-1)}return t[i-1]&&i-o>=e&&s.push([o,i-1]),s}const Qe=32;function ha(t,e,s,{location:o=E.location,distance:n=E.distance,threshold:i=E.threshold,findAllMatches:l=E.findAllMatches,minMatchCharLength:c=E.minMatchCharLength,includeMatches:a=E.includeMatches,ignoreLocation:u=E.ignoreLocation}={}){if(e.length>Qe)throw new Error(ea(Qe));const d=e.length,f=t.length,h=Math.max(0,Math.min(o,f));let y=i,w=h;const S=c>1||a,k=S?Array(f):[];let N;for(;(N=t.indexOf(e,w))>-1;){let j=Pt(e,{currentLocation:N,expectedLocation:h,distance:n,ignoreLocation:u});if(y=Math.min(j,y),w=N+d,S){let P=0;for(;P<d;)k[N+P]=1,P+=1}}w=-1;let v=[],g=1,C=d+f;const U=1<<d-1;for(let j=0;j<d;j+=1){let P=0,F=C;for(;P<F;)Pt(e,{errors:j,currentLocation:h+F,expectedLocation:h,distance:n,ignoreLocation:u})<=y?P=F:C=F,F=Math.floor((C-P)/2+P);C=F;let ee=Math.max(1,h-F+1),te=l?f:Math.min(h+F,f)+d,O=Array(te+2);O[te+1]=(1<<j)-1;for(let q=te;q>=ee;q-=1){let le=q-1,K=s[t.charAt(le)];if(S&&(k[le]=+!!K),O[q]=(O[q+1]<<1|1)&K,j&&(O[q]|=(v[q+1]|v[q])<<1|1|v[q+1]),O[q]&U&&(g=Pt(e,{errors:j,currentLocation:le,expectedLocation:h,distance:n,ignoreLocation:u}),g<=y)){if(y=g,w=le,w<=h)break;ee=Math.max(1,2*h-w)}}if(Pt(e,{errors:j+1,currentLocation:h,expectedLocation:h,distance:n,ignoreLocation:u})>y)break;v=O}const T={isMatch:w>=0,score:Math.max(.001,g)};if(S){const j=pa(k,c);j.length?a&&(T.indices=j):T.isMatch=!1}return T}function ma(t){let e={};for(let s=0,o=t.length;s<o;s+=1){const n=t.charAt(s);e[n]=(e[n]||0)|1<<o-s-1}return e}class ks{constructor(e,{location:s=E.location,threshold:o=E.threshold,distance:n=E.distance,includeMatches:i=E.includeMatches,findAllMatches:l=E.findAllMatches,minMatchCharLength:c=E.minMatchCharLength,isCaseSensitive:a=E.isCaseSensitive,ignoreLocation:u=E.ignoreLocation}={}){if(this.options={location:s,threshold:o,distance:n,includeMatches:i,findAllMatches:l,minMatchCharLength:c,isCaseSensitive:a,ignoreLocation:u},this.pattern=a?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;const d=(h,y)=>{this.chunks.push({pattern:h,alphabet:ma(h),startIndex:y})},f=this.pattern.length;if(f>Qe){let h=0;const y=f%Qe,w=f-y;for(;h<w;)d(this.pattern.substr(h,Qe),h),h+=Qe;if(y){const S=f-Qe;d(this.pattern.substr(S),S)}}else d(this.pattern,0)}searchIn(e){const{isCaseSensitive:s,includeMatches:o}=this.options;if(s||(e=e.toLowerCase()),this.pattern===e){let w={isMatch:!0,score:0};return o&&(w.indices=[[0,e.length-1]]),w}const{location:n,distance:i,threshold:l,findAllMatches:c,minMatchCharLength:a,ignoreLocation:u}=this.options;let d=[],f=0,h=!1;this.chunks.forEach(({pattern:w,alphabet:S,startIndex:k})=>{const{isMatch:N,score:v,indices:g}=ha(e,w,S,{location:n+k,distance:i,threshold:l,findAllMatches:c,minMatchCharLength:a,includeMatches:o,ignoreLocation:u});N&&(h=!0),f+=v,N&&g&&(d=[...d,...g])});let y={isMatch:h,score:h?f/this.chunks.length:1};return h&&o&&(y.indices=d),y}}class Ke{constructor(e){this.pattern=e}static isMultiMatch(e){return Jr(e,this.multiRegex)}static isSingleMatch(e){return Jr(e,this.singleRegex)}search(){}}function Jr(t,e){const s=t.match(e);return s?s[1]:null}class fa extends Ke{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){const s=e===this.pattern;return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class ga extends Ke{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){const o=e.indexOf(this.pattern)===-1;return{isMatch:o,score:o?0:1,indices:[0,e.length-1]}}}class xa extends Ke{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){const s=e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,this.pattern.length-1]}}}class va extends Ke{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){const s=!e.startsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class ba extends Ke{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){const s=e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[e.length-this.pattern.length,e.length-1]}}}class ya extends Ke{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){const s=!e.endsWith(this.pattern);return{isMatch:s,score:s?0:1,indices:[0,e.length-1]}}}class Ns extends Ke{constructor(e,{location:s=E.location,threshold:o=E.threshold,distance:n=E.distance,includeMatches:i=E.includeMatches,findAllMatches:l=E.findAllMatches,minMatchCharLength:c=E.minMatchCharLength,isCaseSensitive:a=E.isCaseSensitive,ignoreLocation:u=E.ignoreLocation}={}){super(e),this._bitapSearch=new ks(e,{location:s,threshold:o,distance:n,includeMatches:i,findAllMatches:l,minMatchCharLength:c,isCaseSensitive:a,ignoreLocation:u})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}}class Rs extends Ke{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let s=0,o;const n=[],i=this.pattern.length;for(;(o=e.indexOf(this.pattern,s))>-1;)s=o+i,n.push([o,s-1]);const l=!!n.length;return{isMatch:l,score:l?0:1,indices:n}}}const mr=[fa,Rs,xa,va,ya,ba,ga,Ns],qr=mr.length,Ca=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,wa="|";function ja(t,e={}){return t.split(wa).map(s=>{let o=s.trim().split(Ca).filter(i=>i&&!!i.trim()),n=[];for(let i=0,l=o.length;i<l;i+=1){const c=o[i];let a=!1,u=-1;for(;!a&&++u<qr;){const d=mr[u];let f=d.isMultiMatch(c);f&&(n.push(new d(f,e)),a=!0)}if(!a)for(u=-1;++u<qr;){const d=mr[u];let f=d.isSingleMatch(c);if(f){n.push(new d(f,e));break}}}return n})}const Ia=new Set([Ns.type,Rs.type]);class Sa{constructor(e,{isCaseSensitive:s=E.isCaseSensitive,includeMatches:o=E.includeMatches,minMatchCharLength:n=E.minMatchCharLength,ignoreLocation:i=E.ignoreLocation,findAllMatches:l=E.findAllMatches,location:c=E.location,threshold:a=E.threshold,distance:u=E.distance}={}){this.query=null,this.options={isCaseSensitive:s,includeMatches:o,minMatchCharLength:n,findAllMatches:l,ignoreLocation:i,location:c,threshold:a,distance:u},this.pattern=s?e:e.toLowerCase(),this.query=ja(this.pattern,this.options)}static condition(e,s){return s.useExtendedSearch}searchIn(e){const s=this.query;if(!s)return{isMatch:!1,score:1};const{includeMatches:o,isCaseSensitive:n}=this.options;e=n?e:e.toLowerCase();let i=0,l=[],c=0;for(let a=0,u=s.length;a<u;a+=1){const d=s[a];l.length=0,i=0;for(let f=0,h=d.length;f<h;f+=1){const y=d[f],{isMatch:w,indices:S,score:k}=y.search(e);if(w){if(i+=1,c+=k,o){const N=y.constructor.type;Ia.has(N)?l=[...l,...S]:l.push(S)}}else{c=0,i=0,l.length=0;break}}if(i){let f={isMatch:!0,score:c/i};return o&&(f.indices=l),f}}return{isMatch:!1,score:1}}}const fr=[];function ka(...t){fr.push(...t)}function gr(t,e){for(let s=0,o=fr.length;s<o;s+=1){let n=fr[s];if(n.condition(t,e))return new n(t,e)}return new ks(t,e)}const $t={AND:"$and",OR:"$or"},xr={PATH:"$path",PATTERN:"$val"},vr=t=>!!(t[$t.AND]||t[$t.OR]),Na=t=>!!t[xr.PATH],Ra=t=>!Oe(t)&&ws(t)&&!vr(t),Xr=t=>({[$t.AND]:Object.keys(t).map(e=>({[e]:t[e]}))});function Ms(t,e,{auto:s=!0}={}){const o=n=>{let i=Object.keys(n);const l=Na(n);if(!l&&i.length>1&&!vr(n))return o(Xr(n));if(Ra(n)){const a=l?n[xr.PATH]:i[0],u=l?n[xr.PATTERN]:n[a];if(!Ie(u))throw new Error(Zn(a));const d={keyId:hr(a),pattern:u};return s&&(d.searcher=gr(u,e)),d}let c={children:[],operator:i[0]};return i.forEach(a=>{const u=n[a];Oe(u)&&u.forEach(d=>{c.children.push(o(d))})}),c};return vr(t)||(t=Xr(t)),o(t)}function Ma(t,{ignoreFieldNorm:e=E.ignoreFieldNorm}){t.forEach(s=>{let o=1;s.matches.forEach(({key:n,norm:i,score:l})=>{const c=n?n.weight:null;o*=Math.pow(l===0&&c?Number.EPSILON:l,(c||1)*(e?1:i))}),s.score=o})}function La(t,e){const s=t.matches;e.matches=[],ge(s)&&s.forEach(o=>{if(!ge(o.indices)||!o.indices.length)return;const{indices:n,value:i}=o;let l={indices:n,value:i};o.key&&(l.key=o.key.src),o.idx>-1&&(l.refIndex=o.idx),e.matches.push(l)})}function Ta(t,e){e.score=t.score}function Ea(t,e,{includeMatches:s=E.includeMatches,includeScore:o=E.includeScore}={}){const n=[];return s&&n.push(La),o&&n.push(Ta),t.map(i=>{const{idx:l}=i,c={item:e[l],refIndex:l};return n.length&&n.forEach(a=>{a(i,c)}),c})}class ct{constructor(e,s={},o){this.options={...E,...s},this.options.useExtendedSearch,this._keyStore=new sa(this.options.keys),this.setCollection(e,o)}setCollection(e,s){if(this._docs=e,s&&!(s instanceof Nr))throw new Error(Qn);this._myIndex=s||Ss(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(e){ge(e)&&(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){const s=[];for(let o=0,n=this._docs.length;o<n;o+=1){const i=this._docs[o];e(i,o)&&(this.removeAt(o),o-=1,n-=1,s.push(i))}return s}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:s=-1}={}){const{includeMatches:o,includeScore:n,shouldSort:i,sortFn:l,ignoreFieldNorm:c}=this.options;let a=Ie(e)?Ie(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return Ma(a,{ignoreFieldNorm:c}),i&&a.sort(l),Cs(s)&&s>-1&&(a=a.slice(0,s)),Ea(a,this._docs,{includeMatches:o,includeScore:n})}_searchStringList(e){const s=gr(e,this.options),{records:o}=this._myIndex,n=[];return o.forEach(({v:i,i:l,n:c})=>{if(!ge(i))return;const{isMatch:a,score:u,indices:d}=s.searchIn(i);a&&n.push({item:i,idx:l,matches:[{score:u,value:i,norm:c,indices:d}]})}),n}_searchLogical(e){const s=Ms(e,this.options),o=(c,a,u)=>{if(!c.children){const{keyId:f,searcher:h}=c,y=this._findMatches({key:this._keyStore.get(f),value:this._myIndex.getValueForItemAtKeyId(a,f),searcher:h});return y&&y.length?[{idx:u,item:a,matches:y}]:[]}const d=[];for(let f=0,h=c.children.length;f<h;f+=1){const y=c.children[f],w=o(y,a,u);if(w.length)d.push(...w);else if(c.operator===$t.AND)return[]}return d},n=this._myIndex.records,i={},l=[];return n.forEach(({$:c,i:a})=>{if(ge(c)){let u=o(s,c,a);u.length&&(i[a]||(i[a]={idx:a,item:c,matches:[]},l.push(i[a])),u.forEach(({matches:d})=>{i[a].matches.push(...d)}))}}),l}_searchObjectList(e){const s=gr(e,this.options),{keys:o,records:n}=this._myIndex,i=[];return n.forEach(({$:l,i:c})=>{if(!ge(l))return;let a=[];o.forEach((u,d)=>{a.push(...this._findMatches({key:u,value:l[d],searcher:s}))}),a.length&&i.push({idx:c,item:l,matches:a})}),i}_findMatches({key:e,value:s,searcher:o}){if(!ge(s))return[];let n=[];if(Oe(s))s.forEach(({v:i,i:l,n:c})=>{if(!ge(i))return;const{isMatch:a,score:u,indices:d}=o.searchIn(i);a&&n.push({score:u,key:e,value:i,idx:l,norm:c,indices:d})});else{const{v:i,n:l}=s,{isMatch:c,score:a,indices:u}=o.searchIn(i);c&&n.push({score:a,key:e,value:i,norm:l,indices:u})}return n}}ct.version="7.0.0";ct.createIndex=Ss;ct.parseIndex=da;ct.config=E;ct.parseQuery=Ms;ka(Sa);var Ls={exports:{}};(function(t){(function(){var e=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],s=typeof window<"u",o=s&&window.mozInnerScreenX!=null;function n(i,l,c){if(!s)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");var a=c&&c.debug||!1;if(a){var u=document.querySelector("#input-textarea-caret-position-mirror-div");u&&u.parentNode.removeChild(u)}var d=document.createElement("div");d.id="input-textarea-caret-position-mirror-div",document.body.appendChild(d);var f=d.style,h=window.getComputedStyle?window.getComputedStyle(i):i.currentStyle,y=i.nodeName==="INPUT";f.whiteSpace="pre-wrap",y||(f.wordWrap="break-word"),f.position="absolute",a||(f.visibility="hidden"),e.forEach(function(k){y&&k==="lineHeight"?f.lineHeight=h.height:f[k]=h[k]}),o?i.scrollHeight>parseInt(h.height)&&(f.overflowY="scroll"):f.overflow="hidden",d.textContent=i.value.substring(0,l),y&&(d.textContent=d.textContent.replace(/\s/g,"Â "));var w=document.createElement("span");w.textContent=i.value.substring(l)||".",d.appendChild(w);var S={top:w.offsetTop+parseInt(h.borderTopWidth),left:w.offsetLeft+parseInt(h.borderLeftWidth),height:parseInt(h.lineHeight)};return a?w.style.backgroundColor="#aaa":document.body.removeChild(d),S}t.exports=n})()})(Ls);var Da=Ls.exports;const Pa=ro(Da),Oa=({editorRef:t,editorActions:e})=>{const[s,o]=x.useState(null),n=()=>o(null),{state:i}=Wt(),l=x.useRef(i.tags);l.current=i.tags;const[c,a]=x.useState(0),u=x.useRef(c);u.current=c;const d=()=>{const v=t.current;if(!v)return["",0];const g=v.selectionEnd,C=v.value.slice(0,g).match(/\S*$/)||{0:"",index:g},U=v.value.slice(g).match(/^\S*/)||{0:""};return[C[0]+U[0],C.index??g]},f=x.useRef([]);f.current=(()=>{const v=d()[0].slice(1).toLowerCase();return new ct(l.current).search(v).map(C=>C.item)})();const h=x.useRef(!1);h.current=!!(s&&f.current.length>0);const y=v=>{if(!e||!("current"in e)||!e.current)return;const[g,C]=d();e.current.removeText(C,g.length),e.current.insertText(`#${v}`),n()},w=v=>{if(!h.current)return;const g=f.current,C=u.current;["Escape","ArrowLeft","ArrowRight"].includes(v.code)&&n(),v.code==="ArrowDown"&&(a((C+1)%g.length),v.preventDefault(),v.stopPropagation()),v.code==="ArrowUp"&&(a((C-1+g.length)%g.length),v.preventDefault(),v.stopPropagation()),["Enter","Tab"].includes(v.code)&&(y(g[C]),v.preventDefault(),v.stopPropagation())},S=()=>{const v=t.current;if(!v)return;a(0);const[g,C]=d(),U=v.value[v.selectionEnd],T=g.startsWith("#")&&U!=="#",j=Pa(v,C);j.top-=v.scrollTop,T?o(j):n()},k=x.useRef(!1),N=()=>{const v=t.current;!v||k.current||(v.addEventListener("click",n),v.addEventListener("blur",n),v.addEventListener("keydown",w),v.addEventListener("input",S),k.current=!0)};return x.useEffect(N,[!!t.current]),!h.current||!s?null:r.jsx("div",{className:"z-20 p-1 mt-1 -ml-2 absolute max-w-[12rem] gap-px rounded font-mono flex flex-col justify-start items-start overflow-auto shadow bg-zinc-100 dark:bg-zinc-700",style:{left:s.left,top:s.top+s.height},children:f.current.map((v,g)=>r.jsx("div",{onMouseDown:()=>y(v),className:Pe("rounded p-1 px-2 w-full truncate text-sm dark:text-gray-300 cursor-pointer hover:bg-zinc-200 dark:hover:bg-zinc-800",g===c?"bg-zinc-300 dark:bg-zinc-600":""),children:r.jsxs(ys,{children:["#",v]})},v))})},Aa=x.forwardRef(function(e,s){var f;const{className:o,initialContent:n,placeholder:i,onPaste:l,onContentChange:c}=e,a=x.useRef(null);x.useEffect(()=>{a.current&&n&&(a.current.value=n,c(n))},[]),x.useEffect(()=>{a.current&&u()},[(f=a.current)==null?void 0:f.value]);const u=()=>{a.current&&(a.current.style.height="auto",a.current.style.height=(a.current.scrollHeight??0)+"px")};x.useImperativeHandle(s,()=>({focus:()=>{var h;(h=a.current)==null||h.focus()},scrollToCursor:()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},insertText:(h="",y="",w="")=>{if(!a.current)return;const S=a.current.selectionStart,k=a.current.selectionEnd,N=a.current.value,v=N.slice(0,S)+y+(h||N.slice(S,k))+w+N.slice(k);a.current.value=v,a.current.focus(),a.current.selectionEnd=k+y.length+h.length,c(a.current.value),u()},removeText:(h,y)=>{if(!a.current)return;const w=a.current.value,S=w.slice(0,h)+w.slice(h+y);a.current.value=S,a.current.focus(),a.current.selectionEnd=h,c(a.current.value),u()},setContent:h=>{a.current&&(a.current.value=h,c(a.current.value),u())},getContent:()=>{var h;return((h=a.current)==null?void 0:h.value)??""},getCursorPosition:()=>{var h;return((h=a.current)==null?void 0:h.selectionStart)??0},getSelectedContent:()=>{var w,S,k;const h=(w=a.current)==null?void 0:w.selectionStart,y=(S=a.current)==null?void 0:S.selectionEnd;return((k=a.current)==null?void 0:k.value.slice(h,y))??""},setCursorPosition:(h,y)=>{var S;const w=isNaN(y)?h:y;(S=a.current)==null||S.setSelectionRange(h,w)},getCursorLineNumber:()=>{var w,S;const h=((w=a.current)==null?void 0:w.selectionStart)??0;return(((S=a.current)==null?void 0:S.value.slice(0,h).split(`
`))??[]).length-1},getLine:h=>{var y;return((y=a.current)==null?void 0:y.value.split(`
`)[h])??""},setLine:(h,y)=>{var S;const w=((S=a.current)==null?void 0:S.value.split(`
`))??[];w[h]=y,a.current&&(a.current.value=w.join(`
`),a.current.focus(),c(a.current.value),u())}}),[]);const d=x.useCallback(()=>{var h;c(((h=a.current)==null?void 0:h.value)??""),u()},[]);return r.jsxs("div",{className:Pe("flex flex-col justify-start items-start relative w-full h-auto max-h-[256px] bg-inherit dark:text-gray-300",o),children:[r.jsx("textarea",{className:"w-full h-full my-1 text-base resize-none overflow-x-hidden overflow-y-auto bg-transparent outline-none whitespace-pre-wrap word-break",rows:1,placeholder:i,ref:a,onPaste:l,onInput:d}),r.jsx(Oa,{editorRef:a,editorActions:s})]})}),_a=t=>{const{relationList:e,setRelationList:s}=t,o=We(),[n,i]=x.useState([]);x.useEffect(()=>{(async()=>{const c=e.filter(u=>u.type===it.REFERENCE).map(async u=>await o.getOrFetchMemoById(u.relatedMemoId,{skipStore:!0})),a=await Promise.all(c);i(a)})()},[e]);const l=async c=>{s(e.filter(a=>a.relatedMemoId!==c.id))};return r.jsx(r.Fragment,{children:n.length>0&&r.jsx("div",{className:"w-full flex flex-row gap-2 mt-2 flex-wrap",children:n.map(c=>r.jsxs("div",{className:"w-auto max-w-xs overflow-hidden flex flex-row justify-start items-center bg-zinc-100 dark:bg-zinc-900 hover:opacity-80 rounded-md text-sm p-1 px-2 text-gray-500 dark:text-gray-400 cursor-pointer hover:line-through",onClick:()=>l(c),children:[r.jsx(_.Link,{className:"w-4 h-auto shrink-0 opacity-80"}),r.jsx("span",{className:"mx-1 max-w-full text-ellipsis whitespace-nowrap overflow-hidden",children:c.content}),r.jsx(_.X,{className:"w-4 h-auto cursor-pointer shrink-0 opacity-60 hover:opacity-100"})]},c.name))})})},$a=t=>{const{resourceList:e,setResourceList:s}=t,o=async n=>{s(e.filter(i=>i.id!==n))};return r.jsx(r.Fragment,{children:e.length>0&&r.jsx("div",{className:"w-full flex flex-row justify-start flex-wrap gap-2 mt-2",children:e.map(n=>r.jsxs("div",{className:"max-w-full flex flex-row justify-start items-center flex-nowrap gap-x-1 bg-zinc-100 dark:bg-zinc-900 px-2 py-1 rounded text-gray-500 dark:text-gray-400",children:[r.jsx(Co,{resource:n,className:"!w-4 !h-4 !opacity-100"}),r.jsx("span",{className:"text-sm max-w-[8rem] truncate",children:n.filename}),r.jsx(_.X,{className:"w-4 h-auto cursor-pointer opacity-60 hover:opacity-100",onClick:()=>o(n.id)})]},n.id))})})},za=(t,e)=>{if(t.key==="b"){const s="**";t.preventDefault(),Yr(e,s)}else if(t.key==="i"){const s="*";t.preventDefault(),Yr(e,s)}else t.key==="k"&&(t.preventDefault(),Ts(e))},Ts=(t,e)=>{const s=t.getCursorPosition(),o=t.getSelectedContent(),n="url";if(e=e??n,t.insertText(`[${o}](${e})`),e===n){const i=s+o.length+3;t.setCursorPosition(i,i+e.length)}},Yr=(t,e)=>{const s=t.getCursorPosition(),o=t.getSelectedContent();if(o.startsWith(e)&&o.endsWith(e)){t.insertText(o.slice(e.length,-e.length));const n=o.length-e.length*2;t.setCursorPosition(s,s+n)}else t.insertText(`${e}${o}${e}`),t.setCursorPosition(s+e.length,s+e.length+o.length)},Fa=t=>{const{className:e,editorClassName:s,cacheKey:o,memoId:n,parentMemoId:i,autoFocus:l,onConfirm:c}=t,{i18n:a}=ns(),u=He(),{state:{systemStatus:d}}=Cr(),f=Ut(),h=We(),y=gs(),w=Wt(),S=De(),[k,N]=x.useState({memoVisibility:Ee.PRIVATE,resourceList:[],relationList:t.relationList??[],isUploadingResource:!1,isRequesting:!1,isComposing:!1}),[v,g]=x.useState(!1),C=x.useRef(null),U=f.userSetting,T=`${S.name}-${o||""}`,[j,P]=so(T,""),F=n?k.relationList.filter(b=>b.memoId===n&&b.relatedMemoId!==n&&b.type===it.REFERENCE):k.relationList.filter(b=>b.type===it.REFERENCE);x.useEffect(()=>{var b;(b=C.current)==null||b.setContent(j||"")},[]),x.useEffect(()=>{l&&qe()},[l]),x.useEffect(()=>{let b=U.memoVisibility;d.disablePublicMemos&&b==="PUBLIC"&&(b="PRIVATE"),N($=>({...$,memoVisibility:uo(b)}))},[U.memoVisibility,d.disablePublicMemos]),x.useEffect(()=>{n&&h.getOrFetchMemoById(n??gt).then(b=>{var $;b&&(qe(),N(A=>({...A,memoVisibility:b.visibility,resourceList:b.resources,relationList:b.relations})),j||($=C.current)==null||$.setContent(b.content??""))})},[n]);const ee=()=>{N(b=>({...b,isComposing:!0}))},te=()=>{N(b=>({...b,isComposing:!1}))},O=b=>{if(!C.current)return;if(b.ctrlKey||b.metaKey){if(b.key==="Enter"){et();return}za(b,C.current)}if(b.key==="Tab"&&!k.isComposing){b.preventDefault();const A=" ".repeat($r),X=C.current.getCursorPosition(),H=C.current.getSelectedContent();C.current.insertText(A),H&&C.current.setCursorPosition(X+$r);return}},he=b=>{N($=>({...$,memoVisibility:b}))},q=()=>{_n({onConfirm:b=>{N($=>({...$,resourceList:[...$.resourceList,...b]}))}})},le=b=>{N($=>({...$,resourceList:b}))},K=b=>{N($=>({...$,relationList:b}))},Ae=async b=>{N(A=>({...A,isUploadingResource:!0}));let $;try{$=await y.createResourceWithBlob(b)}catch(A){console.error(A),Se.error(typeof A=="string"?A:A.response.data.message)}return N(A=>({...A,isUploadingResource:!1})),$},Re=async b=>{const $=[];for(const A of b){const X=await Ae(A);X&&($.push(X),n&&await y.updateResource({resource:no.fromPartial({id:X.id,memoId:n}),updateMask:["memo_id"]}))}$.length>0&&N(A=>({...A,resourceList:[...A.resourceList,...$]}))},Ge=async b=>{b.dataTransfer&&b.dataTransfer.files.length>0&&(b.preventDefault(),await Re(b.dataTransfer.files))},Je=async b=>{b.clipboardData&&b.clipboardData.files.length>0?(b.preventDefault(),await Re(b.clipboardData.files)):C.current!=null&&C.current.getSelectedContent().length!=0&&oo(b.clipboardData.getData("Text"))&&(b.preventDefault(),Ts(C.current,b.clipboardData.getData("Text")))},Ce=b=>{g(b!==""),b!==""?P(b):localStorage.removeItem(T)},et=async()=>{var A,X;if(k.isRequesting)return;N(H=>({...H,isRequesting:!0}));const b=((A=C.current)==null?void 0:A.getContent())??"";try{if(n&&n!==gt){const H=await h.getOrFetchMemoById(n??gt);if(H){const me=await h.updateMemo({id:H.id,content:b,visibility:k.memoVisibility},["content","visibility"]);await je.setMemoResources({id:me.id,resources:k.resourceList}),await je.setMemoRelations({id:me.id,relations:k.relationList}),await h.getOrFetchMemoById(me.id,{skipCache:!0}),c&&c(me.id)}}else{const me=await(i?je.createMemoComment({id:i,create:{content:b,visibility:k.memoVisibility}}).then(({memo:ce})=>ce):h.createMemo({content:b,visibility:k.memoVisibility}));await je.setMemoResources({id:me.id,resources:k.resourceList}),await je.setMemoRelations({id:me.id,relations:k.relationList}),await h.getOrFetchMemoById(me.id,{skipCache:!0}),c&&c(me.id)}(X=C.current)==null||X.setContent("")}catch(H){console.error(H),Se.error(H.details)}const $=Pn(b);await w.batchUpsertTag($),N(H=>({...H,isRequesting:!1,resourceList:[],relationList:[]}))},qe=()=>{var b;(b=C.current)==null||b.focus()},ae=x.useMemo(()=>({className:s??"",initialContent:"",placeholder:u("editor.placeholder"),onContentChange:Ce,onPaste:Je}),[a.language]),oe=(v||k.resourceList.length>0)&&!k.isUploadingResource&&!k.isRequesting;return r.jsx(xs.Provider,{value:{relationList:k.relationList,setRelationList:b=>{N($=>({...$,relationList:b}))},memoId:n},children:r.jsxs("div",{className:`${e??""} relative w-full flex flex-col justify-start items-start bg-white dark:bg-zinc-800 px-4 pt-4 rounded-lg border border-gray-200 dark:border-zinc-700`,tabIndex:0,onKeyDown:O,onDrop:Ge,onFocus:qe,onCompositionStart:ee,onCompositionEnd:te,children:[r.jsx(Aa,{ref:C,...ae}),r.jsx($a,{resourceList:k.resourceList,setResourceList:le}),r.jsx(_a,{relationList:F,setRelationList:K}),r.jsx("div",{className:"relative w-full flex flex-row justify-between items-center pt-2",onFocus:b=>b.stopPropagation(),children:r.jsxs("div",{className:"flex flex-row justify-start items-center opacity-80",children:[r.jsx(Kn,{editorRef:C}),r.jsx(Un,{editorRef:C}),r.jsx(Ne,{size:"sm",onClick:q,children:r.jsx(_.Image,{className:"w-5 h-5 mx-auto"})}),r.jsx(Fn,{editorRef:C})]})}),r.jsx(us,{className:"!mt-2"}),r.jsxs("div",{className:"w-full flex flex-row justify-between items-center py-3 dark:border-t-zinc-500",children:[r.jsx("div",{className:"relative flex flex-row justify-start items-center",onFocus:b=>b.stopPropagation(),children:r.jsx(Sr,{variant:"plain",value:k.memoVisibility,startDecorator:r.jsx(jr,{visibility:k.memoVisibility}),onChange:(b,$)=>{$&&he($)},children:[Ee.PRIVATE,Ee.PROTECTED,Ee.PUBLIC].map(b=>r.jsx(_t,{value:b,className:"whitespace-nowrap",children:u(`memo.visibility.${Ir(b).toLowerCase()}`)},b))})}),r.jsx("div",{className:"shrink-0 flex flex-row justify-end items-center",children:r.jsx(ke,{disabled:!oe,loading:k.isRequesting,endDecorator:r.jsx(_.Send,{className:"w-4 h-auto"}),onClick:et,children:u("editor.save")})})]})]})})},Ba=({memoId:t,cacheKey:e,relationList:s,destroy:o})=>{const n=Cr(),i=Wt(),{systemStatus:l}=n.state;x.useEffect(()=>{i.fetchTags()},[]);const c=()=>{o()};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"w-full flex flex-row justify-between items-center mb-2",children:[r.jsxs("div",{className:"flex flex-row justify-start items-center",children:[r.jsx("img",{className:"w-6 h-auto rounded-full shadow",src:l.customizedProfile.logoUrl,alt:""}),r.jsx("p",{className:"ml-1 text-lg opacity-80 dark:text-gray-300",children:l.customizedProfile.name})]}),r.jsx(Ne,{size:"sm",onClick:c,children:r.jsx(_.X,{className:"w-5 h-auto"})})]}),r.jsx("div",{className:"flex flex-col justify-start items-start max-w-full w-[36rem]",children:r.jsx(Fa,{className:"border-none !p-0 -mb-2",cacheKey:`memo-editor-${e||t}`,memoId:t,relationList:s,onConfirm:c,autoFocus:!0})})]})};function Va(t={}){lt({className:"memo-editor-dialog",dialogName:"memo-editor-dialog",containerClassName:"dark:!bg-zinc-800"},Ba,t)}const ur=new Map,Qr=async(t,e=!0)=>{if(e&&ur.has(t))return Promise.resolve(ur.get(t));const o=await(await fetch(t)).blob();return new Promise(n=>{const i=new FileReader;i.onloadend=()=>{const l=i.result;ur.set(t,l),n(l)},i.readAsDataURL(o)})},Es=async(t,e)=>{if(!t||!e)return;if(t.tagName==="IMG"){const o=t.getAttribute("src")??"";let n=!1;try{e.src=await Qr(o)}catch{n=!0}if(n)try{e.src=await Qr(`/o/get/image?url=${o}`)}catch{}}const s=window.getComputedStyle(t);for(const o of s)e.style.setProperty(o,s.getPropertyValue(o),s.getPropertyPriority(o));for(let o=0;o<e.childElementCount;o++)await Es(t.children[o],e.children[o])},Ua=async t=>{const e=document.createElement(t.tagName);return e.innerHTML=t.innerHTML,await Es(t,e),e},Ha=(t,e)=>new Promise((s,o)=>{t.loading="eager",t.onload=()=>{setTimeout(()=>{s()},200)},t.onerror=()=>{o("Image load failed")},t.src=e}),Ds=t=>{const{width:e,height:s}=window.getComputedStyle(t);return{width:parseInt(e.replace("px","")),height:parseInt(s.replace("px",""))}},Wa=t=>{const e=new XMLSerializer().serializeToString(t);return`data:image/svg+xml;charset=utf-8,${encodeURIComponent(e)}`},Ka=(t,e,s)=>{const o="http://www.w3.org/2000/svg",n=document.createElementNS(o,"svg");n.setAttribute("width",`${t}`),n.setAttribute("height",`${e}`),n.setAttribute("viewBox",`0 0 ${t} ${e}`);const i=document.createElementNS(o,"foreignObject");return i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),i.appendChild(s),n.appendChild(i),n},Ga=async(t,e)=>{const{width:s,height:o}=Ds(t),n=await Ua(t);e!=null&&e.backgroundColor&&(n.style.backgroundColor=e.backgroundColor);const i=Ka(s,o,n);return Wa(i)},Ja=async(t,e)=>{const s=(e==null?void 0:e.pixelRatio)||1,{width:o,height:n}=Ds(t),i=document.createElement("canvas"),l=i.getContext("2d");if(!l)return Promise.reject("Canvas error");i.width=o*s,i.height=n*s,i.style.width=`${o}`,i.style.height=`${n}`,e!=null&&e.backgroundColor&&(l.fillStyle=e.backgroundColor,l.fillRect(0,0,i.width,i.height));const c=await Ga(t,e),a=new Image;return a.style.zIndex="-1",a.style.position="fixed",a.style.top="0",document.body.append(a),await Ha(a,c),l.drawImage(a,0,0,i.width,i.height),a.remove(),i},qa=async(t,e)=>(await Ja(t,e)).toDataURL(),Xa=t=>{const{memoId:e,destroy:s}=t,o=He(),n=Ut(),i=zr(!1),l=zr(),c=x.useRef(null),a=We(),u=a.getMemoById(e),d=n.getUserByUsername(at(u.creator)),f=De(),h=(u==null?void 0:u.creatorId)!==(f==null?void 0:f.id);x.useEffect(()=>{(async()=>(await n.getOrFetchUserByUsername(at(u.creator)),l.setFinish()))()},[]);const y=()=>{s()},w=()=>{c.current&&(i.setLoading(),qa(c.current,{pixelRatio:window.devicePixelRatio*2}).then(v=>{Or(v,`memos-${ft(Date.now())}.png`),i.setFinish(),URL.revokeObjectURL(v)}).catch(v=>{console.error(v)}))},S=()=>{const v=new Blob([u.content],{type:"text/plain;charset=utf-8"}),g=URL.createObjectURL(v);Or(g,`memos-${ft(Date.now())}.md`),URL.revokeObjectURL(g)},k=()=>{cs(`${window.location.origin}/m/${u.name}`),u.visibility!==Ee.PUBLIC?Se.success(o("message.succeed-copy-link-not-public")):Se.success(o("message.succeed-copy-link"))},N=async v=>{(await a.updateMemo({id:u.id,visibility:v},["visibility"])).visibility==v&&Se.success(o("message.update-succeed"))};return l.isLoading?null:r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"dialog-header-container py-3 px-4 !mb-0 rounded-t-lg",children:[r.jsxs("p",{className:"",children:[o("common.share")," Memo"]}),r.jsx(Ne,{size:"sm",onClick:y,children:r.jsx(_.X,{className:"w-5 h-auto"})})]}),r.jsxs("div",{className:"dialog-content-container w-full flex flex-col justify-start items-start relative",children:[r.jsxs("div",{className:"px-4 pb-3 w-full flex flex-row justify-between items-center space-x-2",children:[r.jsxs("div",{className:"flex flex-row justify-start items-center space-x-2",children:[r.jsxs(ke,{color:"neutral",variant:"outlined",disabled:i.isLoading,onClick:w,children:[i.isLoading?r.jsx(_.Loader,{className:"w-4 h-auto mr-1 animate-spin"}):r.jsx(_.Download,{className:"w-4 h-auto mr-1"}),o("common.image")]}),r.jsxs(ke,{color:"neutral",variant:"outlined",onClick:S,children:[r.jsx(_.File,{className:"w-4 h-auto mr-1"}),o("common.file")]}),r.jsxs(ke,{color:"neutral",variant:"outlined",onClick:k,children:[r.jsx(_.Link,{className:"w-4 h-auto mr-1"}),o("common.link")]})]}),!h&&r.jsx(Sr,{className:"w-auto text-sm",variant:"plain",value:u.visibility,startDecorator:r.jsx(jr,{visibility:u.visibility}),onChange:(v,g)=>{g&&N(g)},children:[Ee.PRIVATE,Ee.PROTECTED,Ee.PUBLIC].map(v=>r.jsx(_t,{value:v,className:"whitespace-nowrap",children:o(`memo.visibility.${Ir(v).toLowerCase()}`)},v))})]}),r.jsx("div",{className:"w-full border-t dark:border-zinc-700 overflow-clip",children:r.jsxs("div",{className:"w-full h-auto select-none relative flex flex-col justify-start items-start bg-white dark:bg-zinc-800",ref:c,children:[r.jsx("span",{className:"w-full px-6 pt-5 pb-2 text-sm text-gray-500",children:ft(u.displayTime)}),r.jsxs("div",{className:"w-full px-6 text-base pb-4",children:[r.jsx(wr,{memoId:u.id,content:u.content,readonly:!0,disableFilter:!0}),r.jsx(ls,{resources:u.resources})]}),r.jsxs("div",{className:"flex flex-row justify-between items-center w-full bg-gray-100 dark:bg-zinc-900 py-4 px-6",children:[r.jsxs("div",{className:"flex flex-row justify-start items-center",children:[r.jsx(as,{className:"mr-2",avatarUrl:d.avatarUrl}),r.jsx("div",{className:"w-auto grow truncate flex mr-2 flex-col justify-center items-start",children:r.jsx("span",{className:"w-full text truncate font-medium text-gray-600 dark:text-gray-300",children:d.nickname||d.username})})]}),r.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"via memos"})]})]})})]})]})};function Ya(t){lt({className:"share-memo-dialog",dialogName:"share-memo-dialog"},Xa,{memoId:t})}const Qa=t=>{const{memo:e,hiddenActions:s}=t,o=He(),n=We(),i=async()=>{try{e.pinned?await n.updateMemo({id:e.id,pinned:!1},["pinned"]):await n.updateMemo({id:e.id,pinned:!0},["pinned"])}catch{}},l=()=>{Va({memoId:e.id,cacheKey:`${e.id}-${e.updateTime}`})},c=async()=>{try{await n.updateMemo({id:e.id,rowStatus:ao.ARCHIVED},["row_status"])}catch(d){console.error(d),Ot.error(d.response.data.message)}t.onArchived&&t.onArchived()},a=async()=>{ho({title:o("memo.delete-memo"),content:o("memo.delete-confirm"),style:"danger",dialogName:"delete-memo-dialog",onConfirm:async()=>{await n.deleteMemo(e.id),t.onDeleted&&t.onDeleted()}})},u=()=>{cs(e.name),Ot.success("Copied to clipboard!")};return r.jsxs(Ft,{children:[r.jsx(Bt,{slots:{root:"div"},children:r.jsx("span",{className:Pe("flex justify-center items-center rounded-full hover:opacity-70",t.className),children:r.jsx(_.MoreVertical,{className:"w-4 h-4 mx-auto text-gray-500 dark:text-gray-400"})})}),r.jsxs(Vt,{className:"text-sm",size:"sm",placement:"bottom-end",children:[!(s!=null&&s.includes("pin"))&&r.jsxs(Be,{onClick:i,children:[e.pinned?r.jsx(_.BookmarkMinus,{className:"w-4 h-auto"}):r.jsx(_.BookmarkPlus,{className:"w-4 h-auto"}),e.pinned?o("common.unpin"):o("common.pin")]}),!(s!=null&&s.includes("edit"))&&r.jsxs(Be,{onClick:l,children:[r.jsx(_.Edit3,{className:"w-4 h-auto"}),o("common.edit")]}),!(s!=null&&s.includes("share"))&&r.jsxs(Be,{onClick:()=>Ya(e.id),children:[r.jsx(_.Share,{className:"w-4 h-auto"}),o("common.share")]}),r.jsxs(Be,{color:"warning",onClick:c,children:[r.jsx(_.Archive,{className:"w-4 h-auto"}),o("common.archive")]}),r.jsxs(Be,{color:"danger",onClick:a,children:[r.jsx(_.Trash,{className:"w-4 h-auto"}),o("common.delete")]}),r.jsx(us,{className:"!my-1"}),r.jsx("div",{className:"-mt-0.5 pl-2 pr-2 text-xs text-gray-400",children:r.jsxs("div",{className:"mt-1 font-mono max-w-20 cursor-pointer truncate",onClick:u,children:["ID: ",e.name]})})]})]})},Ps=t=>{switch(t){case G.THUMBS_UP:return"ðŸ‘";case G.THUMBS_DOWN:return"ðŸ‘Ž";case G.HEART:return"ðŸ’›";case G.FIRE:return"ðŸ”¥";case G.CLAPPING_HANDS:return"ðŸ‘";case G.LAUGH:return"ðŸ˜‚";case G.OK_HAND:return"ðŸ‘Œ";case G.ROCKET:return"ðŸš€";case G.EYES:return"ðŸ‘€";case G.THINKING_FACE:return"ðŸ¤”";case G.CLOWN_FACE:return"ðŸ¤¡";case G.QUESTION_MARK:return"â“";default:return""}},Za=(t,e)=>t.length===0?"":t.length<5?t.map(s=>s.nickname||s.username).join(", ")+" reacted with "+e.toLowerCase():`${t.slice(0,4).map(s=>s.nickname||s.username).join(", ")} and ${t.length-4} more reacted with `+e.toLowerCase(),ei=t=>{const{memo:e,reactionType:s,users:o}=t,n=De(),i=We(),l=o.some(a=>n&&a.username===n.username),c=async()=>{if(!n)return;const a=o.findIndex(u=>u.username===n.username);try{if(a===-1)await je.upsertMemoReaction({id:e.id,reaction:{contentId:`${is}${e.id}`,reactionType:s}});else{const u=e.reactions.filter(d=>d.reactionType===s&&d.creator===n.name);for(const d of u)await je.deleteMemoReaction({id:d.id})}}catch{}await i.getOrFetchMemoById(e.id,{skipCache:!0})};return r.jsx(Ze,{title:Za(o,s),placement:"top",children:r.jsxs("div",{className:Pe("h-7 border px-2 py-0.5 rounded-full font-memo flex flex-row justify-center items-center gap-1 dark:border-zinc-700",n&&"cursor-pointer",l&&"bg-blue-100 border-blue-200 dark:bg-zinc-900"),onClick:c,children:[r.jsx("span",{children:Ps(s)}),r.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:o.length})]})})},ti=[G.THUMBS_UP,G.THUMBS_DOWN,G.HEART,G.FIRE,G.CLAPPING_HANDS,G.LAUGH,G.OK_HAND,G.ROCKET,G.EYES,G.THINKING_FACE,G.CLOWN_FACE,G.QUESTION_MARK],Os=t=>{const{memo:e,className:s}=t,o=De(),n=We(),[i,l]=x.useState(!1),c=x.useRef(null);bs(c,()=>{l(!1)});const a=d=>e.reactions.some(f=>f.reactionType===d&&f.creator===(o==null?void 0:o.name)),u=async d=>{try{if(a(d)){const f=e.reactions.filter(h=>h.reactionType===d&&h.creator===o.name);for(const h of f)await je.deleteMemoReaction({id:h.id})}else await je.upsertMemoReaction({id:e.id,reaction:{contentId:`${is}${e.id}`,reactionType:d}});await n.getOrFetchMemoById(e.id,{skipCache:!0})}catch{}l(!1)};return r.jsxs(Ft,{open:i,onOpenChange:(d,f)=>l(f),children:[r.jsx(Bt,{slots:{root:"div"},children:r.jsx("span",{className:Pe("h-7 w-7 flex justify-center items-center rounded-full border dark:border-zinc-700 hover:opacity-70",s),children:r.jsx(_.SmilePlus,{className:"w-4 h-4 mx-auto text-gray-500 dark:text-gray-400"})})}),r.jsx(Vt,{className:"relative text-sm",component:"div",size:"sm",placement:"bottom-start",children:r.jsx("div",{ref:c,children:r.jsx("div",{className:"grid grid-cols-6 py-0.5 px-2 h-auto font-mono gap-1",children:ti.map(d=>r.jsx("span",{className:Pe("inline-flex w-auto cursor-pointer rounded text-lg px-1 text-gray-500 dark:text-gray-400 hover:opacity-80",a(d)&&"bg-blue-100 dark:bg-zinc-800"),onClick:()=>u(d),children:Ps(d)},d))})})})]})},ri=t=>{const{memo:e,reactions:s}=t,o=De(),n=Ut(),[i,l]=x.useState(new Map);return x.useEffect(()=>{(async()=>{const c=new Map;for(const a of s){const u=await n.getOrFetchUserByUsername(at(a.creator)),d=c.get(a.reactionType)||[];d.push(u),c.set(a.reactionType,Tn(d))}l(c)})()},[s]),s.length>0&&r.jsxs("div",{className:"w-full mt-2 flex flex-row justify-start items-start flex-wrap gap-1 select-none",children:[Array.from(i).map(([c,a])=>r.jsx(ei,{memo:e,reactionType:c,users:a},`${c.toString()} ${a.length}`)),o&&r.jsx(Os,{memo:e})]})},si=x.memo(ri),oi=t=>{const{memo:e,relations:s}=t,o=We(),[n,i]=x.useState([]),[l,c]=x.useState([]);return x.useEffect(()=>{(async()=>{const a=await Promise.all(s.filter(d=>d.memoId===e.id&&d.relatedMemoId!==e.id).map(d=>o.getOrFetchMemoById(d.relatedMemoId,{skipStore:!0})));i(a);const u=await Promise.all(s.filter(d=>d.memoId!==e.id&&d.relatedMemoId===e.id).map(d=>o.getOrFetchMemoById(d.memoId,{skipStore:!0})));c(u)})()},[e,s]),r.jsxs(r.Fragment,{children:[n.length>0&&r.jsx("div",{className:"w-full mt-2 flex flex-row justify-start items-center flex-wrap gap-2",children:n.map(a=>r.jsx("div",{className:"block w-auto max-w-[50%]",children:r.jsxs(At,{className:"px-2 border rounded-md w-auto text-sm leading-6 flex flex-row justify-start items-center flex-nowrap text-gray-600 dark:text-gray-400 dark:border-zinc-700 dark:bg-zinc-900 hover:shadow hover:opacity-80",to:`/m/${a.name}`,unstable_viewTransition:!0,children:[r.jsx(Ze,{title:"Reference",placement:"top",children:r.jsx(_.Link,{className:"w-4 h-auto shrink-0 opacity-70"})}),r.jsx("span",{className:"truncate ml-1",children:a.content})]})},a.name))}),l.length>0&&r.jsx("div",{className:"w-full mt-2 flex flex-row justify-start items-center flex-wrap gap-2",children:l.map(a=>r.jsx("div",{className:"block w-auto max-w-[50%]",children:r.jsxs(At,{className:"px-2 border rounded-md w-auto text-sm leading-6 flex flex-row justify-start items-center flex-nowrap text-gray-600 dark:text-gray-400 dark:border-zinc-700 dark:bg-zinc-900 hover:shadow hover:opacity-80",to:`/m/${a.name}`,unstable_viewTransition:!0,children:[r.jsx(Ze,{title:"Backlink",placement:"top",children:r.jsx(_.Milestone,{className:"w-4 h-auto shrink-0 opacity-70"})}),r.jsx("span",{className:"truncate ml-1",children:a.content})]})},a.name))})]})},ni=x.memo(oi),ai=t=>{const{memo:e,className:s}=t,o=He(),n=io(),{i18n:i}=ns(),l=De(),c=Ut(),a=De(),[u,d]=x.useState(_r(ar(e.displayTime))),[f,h]=x.useState(c.getUserByUsername(at(e.creator))),y=x.useRef(null),w=e.relations.filter(g=>g.type===it.REFERENCE),S=e.relations.filter(g=>g.type===it.COMMENT&&g.relatedMemoId===e.id).length,k=e.creator!==(a==null?void 0:a.name);x.useEffect(()=>{(async()=>{const g=await c.getOrFetchUserByUsername(at(e.creator));h(g)})()},[]),x.useEffect(()=>{let g=-1;return Date.now()-ar(e.displayTime)<1e3*60*60*24&&(g=setInterval(()=>{d(_r(ar(e.displayTime)))},1e3*1)),()=>{clearInterval(g)}},[i.language]);const N=g=>{g.altKey?Dn(e.id):n(`/m/${e.name}`)},v=x.useCallback(async g=>{const C=g.target;if(C.tagName==="IMG"){const U=C.getAttribute("src");U&&wo([U],0)}},[]);return r.jsxs("div",{className:Pe("group relative flex flex-col justify-start items-start w-full px-4 pt-2 pb-3 mb-2 bg-white dark:bg-zinc-800 rounded-lg border border-white dark:border-zinc-800 hover:border-gray-200 dark:hover:border-zinc-700","memos-"+e.id,e.pinned&&t.showPinned&&"border-gray-200 border dark:border-zinc-700",s),ref:y,children:[r.jsxs("div",{className:"w-full h-7 flex flex-row justify-between items-center mb-1",children:[r.jsxs("div",{className:"w-auto flex flex-row justify-start items-center mr-1",children:[t.showCreator&&f&&r.jsxs(r.Fragment,{children:[r.jsx(At,{to:`/u/${encodeURIComponent(at(e.creator))}`,unstable_viewTransition:!0,children:r.jsx(Ze,{title:"Creator",placement:"top",children:r.jsxs("span",{className:"flex flex-row justify-start items-center",children:[r.jsx(as,{className:"!w-5 !h-5 mr-1",avatarUrl:f.avatarUrl}),r.jsx("span",{className:"text-sm text-gray-600 max-w-[8em] truncate dark:text-gray-400",children:f.nickname||f.username})]})})}),r.jsx(_.Dot,{className:"w-4 h-auto text-gray-400 dark:text-zinc-400"})]}),r.jsx("span",{className:"text-sm text-gray-400 select-none",onClick:N,children:u}),t.showPinned&&e.pinned&&r.jsxs(r.Fragment,{children:[r.jsx(_.Dot,{className:"w-4 h-auto text-gray-400 dark:text-zinc-400"}),r.jsx(Ze,{title:"Pinned",placement:"top",children:r.jsx(_.Bookmark,{className:"w-4 h-auto text-amber-500"})})]})]}),r.jsxs("div",{className:"flex flex-row justify-end items-center select-none gap-1",children:[r.jsxs("div",{className:"w-auto invisible group-hover:visible flex flex-row justify-between items-center gap-1",children:[t.showVisibility&&e.visibility!==Ee.PRIVATE&&r.jsx(Ze,{title:o(`memo.visibility.${Ir(e.visibility).toLowerCase()}`),placement:"top",children:r.jsx("span",{className:"flex justify-center items-center hover:opacity-70",children:r.jsx(jr,{visibility:e.visibility})})}),l&&r.jsx(Os,{className:"border-none",memo:e})]}),r.jsxs(At,{className:Pe("flex flex-row justify-start items-center hover:opacity-70",S===0&&"invisible group-hover:visible"),to:`/m/${e.name}#comments`,unstable_viewTransition:!0,children:[r.jsx(_.MessageCircleMore,{className:"w-4 h-4 mx-auto text-gray-500 dark:text-gray-400"}),S>0&&r.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:S})]}),!k&&r.jsx(Qa,{memo:e,hiddenActions:t.showPinned?[]:["pin"]})]})]}),r.jsx(wr,{memoId:e.id,content:e.content,readonly:k,onClick:v,compact:!0},`${e.id}-${e.updateTime}`),r.jsx(ls,{resources:e.resources}),r.jsx(ni,{memo:e,relations:w}),r.jsx(si,{memo:e,reactions:e.reactions})]})},wi=x.memo(ai);export{wi as M,ys as O,Ci as T,Fa as a,ni as b,Qa as c,Va as d,Ya as s,Wt as u};

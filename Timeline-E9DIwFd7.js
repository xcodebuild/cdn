import{j as e,p as d,T as $,q as E,r as h,s as T,I as w,u as z,t as O,k as _,l as L,m as A,o as I,bo as B,B as F}from"./index-DRKdyhzb.js";import{e as R,f as U,g as N,c as P}from"./index-2UGuc62r.js";import{E as q}from"./Empty-BkwmF9Ca.js";import{M as J,d as W}from"./MemoView-Cm1UAYRp.js";import{u as Y,M as Z}from"./useFilterWithUrlParams-BmmRipFM.js";import{D as G,M as Q}from"./MobileHeader-DhNMB_G6.js";import{S as H}from"./SearchBar-ySL2wKLk.js";import{T as V}from"./TagList-CHPb-FDY.js";import{D as K,a as X}from"./CommonDialog-aMGtbYQ-.js";import{D as ee}from"./Divider-ByJybYhk.js";import"./index-BG_UZG-p.js";import"./ResourceIcon-CVNzAEyj.js";import"./useLoading-Dble4Yjd.js";import"./Checkbox-BFDDHFvA.js";import"./createSvgIcon-DiGfNeH6.js";import"./Typography-B6lazjNl.js";import"./VisibilityIcon-ijzoLo4J.js";import"./Select-2jlx2KYh.js";import"./Link-bshFRLSU.js";import"./last-DXTTfs9a.js";const D=(a,m)=>{if(a===0)return"bg-gray-100 text-gray-400 dark:bg-gray-700 dark:text-gray-500";const r=a/m;return r>.7?"bg-blue-600 text-gray-100 dark:opacity-80":r>.4?"bg-blue-400 text-gray-200 dark:opacity-80":"bg-blue-300 text-gray-600 dark:opacity-80"},te=a=>{const{month:m,data:r,onClick:i}=a,l=new Date(m).getUTCFullYear(),n=new Date(m).getUTCMonth()+1,g=new Date(l,n,0).getDate(),f=new Date(l,n-1,1).getDay(),j=new Date(l,n-1,g).getDay(),b=Math.max(...Object.values(r)),y=[];for(let t=0;t<f;t++)y.push(0);for(let t=1;t<=g;t++)y.push(t);for(let t=0;t<6-j;t++)y.push(0);return e.jsx("div",{className:d("w-36 h-auto p-0.5 shrink-0 grid grid-cols-7 grid-flow-row gap-1"),children:y.map((t,p)=>{const o=R(U(`${l}-${String(n).padStart(2,"0")}-${String(t).padStart(2,"0")}`)),x=r[o]||0,S=new Date().toDateString()===new Date(o).toDateString(),v=x?`${x} memos in ${o}`:o;return t?e.jsx($,{className:"shrink-0",title:v,placement:"top",arrow:!0,children:e.jsx("div",{className:d("w-4 h-4 text-[9px] rounded-md flex justify-center items-center border border-transparent",D(x,b),S&&"border-gray-600 dark:!border-gray-500"),onClick:()=>x&&i&&i(o),children:t})},`${o}-${p}`):e.jsx("div",{className:d("shrink-0 opacity-30 w-4 h-4 rounded-md flex justify-center items-center border border-transparent",D(x,b))},`${o}-${p}`)})})},M=a=>e.jsxs("aside",{className:d("relative w-full h-auto max-h-screen overflow-auto hide-scrollbar flex flex-col justify-start items-start",a.className),children:[e.jsx(H,{}),e.jsx(V,{})]}),se=()=>{const a=E(),[m,r]=h.useState(!1);h.useEffect(()=>{r(!1)},[a.pathname]);const i=l=>n=>{n.type==="keydown"&&(n.key==="Tab"||n.key==="Shift")||r(l)};return e.jsxs(e.Fragment,{children:[e.jsx(T,{onClick:i(!0),children:e.jsx(w.Search,{className:"w-5 h-auto dark:text-gray-400"})}),e.jsx(G,{anchor:"right",size:"sm",open:m,onClose:i(!1),children:e.jsx("div",{className:"w-full h-full px-5 bg-zinc-100 dark:bg-zinc-900",children:e.jsx(M,{className:"py-4"})})})]})},ae=(a,m)=>{const r=[];return Object.entries(a).forEach(([i,l])=>{const n=i.split("-").slice(0,2).join("-"),g=r.find(f=>f.month===n);if(g)g.data[i]=l;else{const f=m.filter(j=>P(j.displayTime).startsWith(n));r.push({month:n,data:{[i]:l},memos:f})}}),r.filter(i=>i.memos.length>0).sort((i,l)=>N(l.month)-N(i.month))},ve=()=>{const a=z(),{md:m}=O(),r=_(),i=L(),l=A(),[n,g]=h.useState({}),[f,j]=h.useState(),[b,y]=h.useState(!0),t=h.useRef(void 0),{tag:p,text:o}=Y(),x=l.value.sort((s,c)=>N(c.displayTime)-N(s.displayTime)),S=ae(n,x);h.useEffect(()=>{t.current=void 0,l.reset(),v()},[f,p,o]),h.useEffect(()=>{(async()=>{const s=['row_status == "NORMAL"'],c=[];p&&c.push(JSON.stringify(`#${p}`)),o&&c.push(JSON.stringify(o)),c.length>0&&s.push(`content_search == [${c.join(", ")}]`);const{stats:u}=await I.getUserMemosStats({name:r.name,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,filter:s.join(" && ")});g(u)})()},[x.length]);const v=async()=>{const s=[`creator == "${r.name}"`,'row_status == "NORMAL"'],c=[];if(p&&c.push(JSON.stringify(`#${p}`)),o&&c.push(JSON.stringify(o)),c.length>0&&s.push(`content_search == [${c.join(", ")}]`),f){const k=N(f)+new Date().getTimezoneOffset()*60*1e3;s.push(`display_time_after == ${k/1e3}`,`display_time_before == ${(k+X)/1e3}`)}y(!0);const u=await i.fetchMemos({pageSize:K,filter:s.join(" && "),pageToken:t.current});y(!1),t.current=u.nextPageToken},C=()=>{W({})};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!m&&e.jsx(Q,{children:e.jsx(se,{})}),e.jsxs("div",{className:d("w-full flex flex-row justify-start items-start px-4 sm:px-6 gap-4"),children:[e.jsx("div",{className:d(m?"w-[calc(100%-15rem)]":"w-full"),children:e.jsxs("div",{className:"w-full shadow flex flex-col justify-start items-start px-4 py-3 rounded-xl bg-white dark:bg-zinc-800 text-black dark:text-gray-300",children:[e.jsxs("div",{className:"relative w-full flex flex-row justify-between items-center",children:[e.jsx("div",{children:e.jsxs("div",{className:"py-1 flex flex-row justify-start items-center select-none opacity-80",onClick:()=>j(void 0),children:[e.jsx(w.GanttChartSquare,{className:"w-6 h-auto mr-1 opacity-80"}),e.jsx("span",{className:"text-lg",children:a("timeline.title")})]})}),e.jsx("div",{className:"flex justify-end items-center gap-2",children:e.jsx(T,{variant:"outlined",size:"sm",onClick:()=>C(),children:e.jsx(w.Plus,{className:"w-5 h-auto"})})})]}),e.jsxs("div",{className:"w-full h-auto flex flex-col justify-start items-start",children:[e.jsx(Z,{className:"px-2 my-4"}),S.map((s,c)=>e.jsxs(h.Fragment,{children:[e.jsxs("div",{className:d("flex flex-col justify-start items-start w-full mt-2 last:mb-4"),children:[e.jsxs("div",{className:d("flex shrink-0 flex-row w-full pl-1 mt-2 mb-2"),children:[e.jsxs("div",{className:d("w-full flex flex-col"),children:[e.jsx("span",{className:"font-medium text-3xl leading-none mb-1",children:new Date(s.month).toLocaleString(B.language,{month:"short",timeZone:"UTC"})}),e.jsx("span",{className:"opacity-60",children:new Date(s.month).getUTCFullYear()})]}),e.jsx(te,{month:s.month,data:s.data,onClick:u=>j(u)})]}),e.jsx("div",{className:d("w-full flex flex-col justify-start items-start"),children:s.memos.map((u,k)=>e.jsxs("div",{className:d("relative w-full flex flex-col justify-start items-start pl-4 sm:pl-10 pt-0"),children:[e.jsx(J,{className:"!border max-w-full !border-gray-100 dark:!border-zinc-700",memo:u}),e.jsxs("div",{className:"absolute -left-2 sm:left-2 top-4 h-full",children:[k!==s.memos.length-1&&e.jsx("div",{className:"absolute top-2 left-[7px] h-full w-0.5 bg-gray-200 dark:bg-gray-700 block"}),e.jsx("div",{className:"border-4 rounded-full border-white relative dark:border-zinc-800",children:e.jsx(w.Circle,{className:"w-2 h-auto bg-gray-200 text-gray-200 dark:bg-gray-700 dark:text-gray-700 rounded-full"})})]})]},`${u.id}-${u.displayTime}`))})]}),c!==S.length-1&&e.jsx(ee,{className:"w-full !my-4 md:!mb-8 !bg-gray-100 dark:!bg-zinc-700"})]},s.month)),b?e.jsxs("div",{className:"flex flex-row justify-center items-center w-full my-4 text-gray-400",children:[e.jsx(w.Loader,{className:"w-4 h-auto animate-spin mr-1"}),e.jsx("p",{className:"text-sm italic",children:a("memo.fetching-data")})]}):t.current?e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-4",children:e.jsx(F,{variant:"plain",endDecorator:e.jsx(w.ArrowDown,{className:"w-5 h-auto"}),onClick:v,children:a("memo.fetch-more")})}):x.length===0&&e.jsxs("div",{className:"w-full mt-12 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(q,{}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:a("message.no-data")})]})]})]})}),m&&e.jsx("div",{className:"sticky top-0 left-0 shrink-0 -mt-6 w-56 h-full",children:e.jsx(M,{className:"py-6"})})]})]})};export{ve as default};

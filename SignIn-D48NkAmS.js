import{u as z,a as G,b as _,c as B,d as R,r as l,W as F,e as O,j as e,B as w,L as D,g as K,f as q,n as j,h as H}from"./index-DRKdyhzb.js";import{L as Q,A as J}from"./LocaleSelect-zQwq82ad.js";import{u as M,I as y}from"./useLoading-Dble4Yjd.js";import{C as V}from"./Checkbox-BFDDHFvA.js";import{D as X}from"./Divider-ByJybYhk.js";import"./Select-2jlx2KYh.js";import"./createSvgIcon-DiGfNeH6.js";import"./Typography-B6lazjNl.js";const re=()=>{const t=z(),S=G(),o=_(),v=B(),N=R(),a=M(!1),{appearance:L,locale:k,systemStatus:i}=o.state,u=i.profile.mode,[c,f]=l.useState(""),[m,g]=l.useState(""),[p,C]=l.useState(!0),[x,b]=l.useState([]),r=v.getWorkspaceSettingByKey(F.WORKSPACE_SETTING_GENERAL).generalSetting||O.fromPartial({});console.log("workspaceGeneralSetting",r),l.useEffect(()=>{(async()=>{const{data:n}=await K();b(n)})()},[]),l.useEffect(()=>{u==="demo"&&(f("memos-demo"),g("secret"))},[u]);const I=s=>{const n=s.target.value;f(n)},P=s=>{const n=s.target.value;g(n)},U=s=>{o.setLocale(s)},E=s=>{o.setAppearance(s)},A=s=>{s.preventDefault(),h()},h=async()=>{if(!(c===""||m==="")&&!a.isLoading){try{a.setLoading();const{user:s}=await q.signIn({username:c,password:m,neverExpire:p});s?(await N.fetchCurrentUser(),S("/")):j.error(t("message.login-failed"))}catch(s){console.error(s),j.error(s.details||t("message.login-failed"))}a.setFinish()}},T=async s=>{const n=`auth.signin.${s.name}-${s.id}`;if(s.type==="OAUTH2"){const W=H("/auth/callback"),d=s.config.oauth2Config,$=`${d.authUrl}?client_id=${d.clientId}&redirect_uri=${W}&state=${n}&response_type=code&scope=${encodeURIComponent(d.scopes.join(" "))}`;window.location.href=$}};return e.jsxs("div",{className:"py-4 sm:py-8 w-80 max-w-full min-h-[100svh] mx-auto flex flex-col justify-start items-center",children:[e.jsxs("div",{className:"w-full py-4 grow flex flex-col justify-center items-center",children:[e.jsxs("div",{className:"w-full flex flex-row justify-center items-center mb-6",children:[e.jsx("img",{className:"h-14 w-auto rounded-full shadow",src:i.customizedProfile.logoUrl,alt:""}),e.jsx("p",{className:"ml-2 text-5xl text-black opacity-80 dark:text-gray-200",children:i.customizedProfile.name})]}),!r.disallowPasswordLogin&&e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"w-full mt-2",onSubmit:A,children:[e.jsxs("div",{className:"flex flex-col justify-start items-start w-full gap-4",children:[e.jsxs("div",{className:"w-full flex flex-col justify-start items-start gap-2",children:[e.jsx("span",{className:"leading-8 text-gray-600",children:t("common.username")}),e.jsx(y,{className:"w-full",size:"lg",type:"text",readOnly:a.isLoading,placeholder:t("common.username"),value:c,onChange:I,required:!0})]}),e.jsxs("div",{className:"w-full flex flex-col justify-start items-start gap-2",children:[e.jsx("span",{className:"leading-8 text-gray-600",children:t("common.password")}),e.jsx(y,{className:"w-full",size:"lg",type:"password",readOnly:a.isLoading,placeholder:t("common.password"),value:m,onChange:P,required:!0})]})]}),e.jsx("div",{className:"flex flex-row justify-start items-center w-full mt-6",children:e.jsx(V,{className:"dark:!text-gray-400",label:t("common.remember-me"),checked:p,onChange:s=>C(s.target.checked)})}),e.jsx("div",{className:"flex flex-row justify-end items-center w-full mt-6",children:e.jsx(w,{className:"w-full",size:"md",type:"submit",disabled:a.isLoading,loading:a.isLoading,onClick:h,children:t("common.sign-in")})})]}),!r.disallowSignup&&e.jsxs("p",{className:"w-full mt-4 text-sm",children:[e.jsx("span",{className:"dark:text-gray-500",children:t("auth.sign-up-tip")}),e.jsx(D,{to:"/auth/signup",className:"cursor-pointer ml-2 text-blue-600 hover:underline",unstable_viewTransition:!0,children:t("common.sign-up")})]})]}),x.length>0&&e.jsxs(e.Fragment,{children:[!r.disallowPasswordLogin&&e.jsx(X,{className:"!my-4",children:t("common.or")}),e.jsx("div",{className:"w-full flex flex-col space-y-2",children:x.map(s=>e.jsx(w,{variant:"outlined",color:"neutral",className:"w-full",size:"md",onClick:()=>T(s),children:t("common.sign-in-with",{provider:s.name})},s.id))})]})]}),e.jsxs("div",{className:"mt-4 flex flex-row items-center justify-center w-full gap-2",children:[e.jsx(Q,{value:k,onChange:U}),e.jsx(J,{value:L,onChange:E})]})]})};export{re as default};

import{l as y,r as i,o as S,j as e,I as o,k as g,p as j,q as v,s as k,u as M,t as T,m as D,R as E,B as R}from"./index-DRgDHYoO.js";import{E as I}from"./Empty-DAchDJLP.js";import{u as L,a as z,M as O}from"./MemoView-BEDUUCs0.js";import{S as _}from"./SearchBar-jg8Goukd.js";import{T as A}from"./TagList-Cz5uSKaV.js";import{D as C,M as B}from"./MobileHeader-DLc6LEza.js";import{u as P,M as q}from"./useFilterWithUrlParams-C4vxzj15.js";import{D as F}from"./CommonDialog-CH82Q2vd.js";import{g as w}from"./index-BFGkap1V.js";import"./VisibilityIcon-V3cq0ZxR.js";import"./Typography-BSwVQflm.js";import"./useLoading-Bp4Y2TVR.js";import"./index-B_9e4a9Y.js";import"./Select-CJl5VIAu.js";import"./createSvgIcon-Bmjcqfz4.js";import"./Checkbox-cv5AtFNC.js";import"./Link-BtCNqJcs.js";import"./ResourceIcon-D5Y2tg6_.js";import"./Divider-Nkit0Pid.js";import"./last-DXTTfs9a.js";const H=r=>{const{user:t}=r,m=L(),c=y(),[u,n]=i.useState(0),[d,l]=i.useState(!1),f=Math.ceil((Date.now()-t.createTime.getTime())/864e5),x=Object.values(c.getState().memoMapById),h=m.state.tags.length;return i.useEffect(()=>{x.length!==0&&(async()=>{l(!0);const{stats:p}=await S.getUserMemosStats({name:t.name,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone});l(!1),n(Object.values(p).reduce((s,a)=>s+a,0))})()},[x.length,t.name]),e.jsxs("div",{className:"w-full border mt-2 py-2 px-3 rounded-md space-y-0.5 text-gray-500 dark:text-gray-400 bg-zinc-50 dark:bg-zinc-900 dark:border-zinc-800",children:[e.jsx("p",{className:"text-sm font-medium",children:"Statistics"}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex justify-start items-center",children:[e.jsx(o.CalendarDays,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-base sm:text-sm",children:"Days"})]}),e.jsx("span",{className:"font-mono",children:f})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex justify-start items-center",children:[e.jsx(o.Library,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-base sm:text-sm",children:"Memos"})]}),d?e.jsx(o.Loader,{className:"animate-spin w-4 h-auto text-gray-400"}):e.jsx("span",{className:"font-mono",children:u})]}),e.jsxs("div",{className:"w-full flex justify-between items-center",children:[e.jsxs("div",{className:"w-full flex justify-start items-center",children:[e.jsx(o.Hash,{className:"w-4 h-auto mr-1"}),e.jsx("span",{className:"block text-base sm:text-sm",children:"Tags"})]}),e.jsx("span",{className:"font-mono",children:h})]})]})},N=r=>{const t=g();return e.jsxs("aside",{className:j("relative w-full h-auto max-h-screen overflow-auto hide-scrollbar flex flex-col justify-start items-start",r.className),children:[e.jsx(_,{}),e.jsx(H,{user:t}),e.jsx(A,{})]})},U=()=>{const r=v(),[t,m]=i.useState(!1);i.useEffect(()=>{m(!1)},[r.pathname]);const c=u=>n=>{n.type==="keydown"&&(n.key==="Tab"||n.key==="Shift")||m(u)};return e.jsxs(e.Fragment,{children:[e.jsx(k,{onClick:c(!0),children:e.jsx(o.Search,{className:"w-5 h-auto dark:text-gray-400"})}),e.jsx(C,{anchor:"right",size:"sm",open:t,onClose:c(!1),children:e.jsx("div",{className:"w-full h-full px-5 bg-zinc-100 dark:bg-zinc-900",children:e.jsx(N,{className:"py-4"})})})]})},ce=()=>{const r=M(),{md:t}=T(),m=g(),c=y(),u=D(),[n,d]=i.useState(!0),l=i.useRef(void 0),{tag:f,text:x}=P(),h=u.value.filter(s=>s.rowStatus===E.ACTIVE).sort((s,a)=>w(a.displayTime)-w(s.displayTime)).sort((s,a)=>Number(a.pinned)-Number(s.pinned));i.useEffect(()=>{l.current=void 0,u.reset(),p()},[f,x]);const p=async()=>{const s=[`creator == "${m.name}"`,'row_status == "NORMAL"',"order_by_pinned == true"],a=[];f&&a.push(JSON.stringify(`#${f}`)),x&&a.push(JSON.stringify(x)),a.length>0&&s.push(`content_search == [${a.join(", ")}]`),d(!0);const b=await c.fetchMemos({pageSize:F,filter:s.join(" && "),pageToken:l.current});d(!1),l.current=b.nextPageToken};return e.jsxs("section",{className:"@container w-full max-w-5xl min-h-full flex flex-col justify-start items-center sm:pt-3 md:pt-6 pb-8",children:[!t&&e.jsx(B,{children:e.jsx(U,{})}),e.jsxs("div",{className:j("w-full flex flex-row justify-start items-start px-4 sm:px-6 gap-4"),children:[e.jsxs("div",{className:j(t?"w-[calc(100%-15rem)]":"w-full"),children:[e.jsx(z,{className:"mb-2",cacheKey:"home-memo-editor"}),e.jsxs("div",{className:"flex flex-col justify-start items-start w-full max-w-full",children:[e.jsx(q,{className:"px-2 pb-2"}),h.map(s=>e.jsx(O,{memo:s,showVisibility:!0,showPinned:!0},`${s.id}-${s.updateTime}`)),n?e.jsxs("div",{className:"flex flex-row justify-center items-center w-full my-4 text-gray-400",children:[e.jsx(o.Loader,{className:"w-4 h-auto animate-spin mr-1"}),e.jsx("p",{className:"text-sm italic",children:r("memo.fetching-data")})]}):l.current?e.jsx("div",{className:"w-full flex flex-row justify-center items-center my-4",children:e.jsx(R,{variant:"plain",endDecorator:e.jsx(o.ArrowDown,{className:"w-5 h-auto"}),onClick:p,children:r("memo.fetch-more")})}):h.length===0&&e.jsxs("div",{className:"w-full mt-12 mb-8 flex flex-col justify-center items-center italic",children:[e.jsx(I,{}),e.jsx("p",{className:"mt-2 text-gray-600 dark:text-gray-400",children:r("message.no-data")})]})]})]}),t&&e.jsx("div",{className:"sticky top-0 left-0 shrink-0 -mt-6 w-56 h-full",children:e.jsx(N,{className:"py-6"})})]})]})};export{ce as default};
